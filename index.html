<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draft de Softball</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .draft-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
            margin-top: 20px;
            gap: 20px;
        }
        .team-panel {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            width: 45%;
        }
        .player-pool {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            width: 45%;
        }
        h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .player-list {
            list-style: none;
            padding: 0;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
        }
        .player-list li {
            background-color: #e9ecef;
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        .player-list li:hover {
            background-color: #d0d7dd;
        }
        .player-actions {
            display: flex;
            gap: 5px;
        }
        .btn {
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            border: none;
            color: white;
            font-size: 14px;
            transition: background-color 0.2s ease;
        }
        .btn-select {
            background-color: #28a745;
        }
        .btn-select:hover {
            background-color: #218838;
        }
        .btn-replace {
            background-color: #ffc107;
            color: #212529;
        }
        .btn-replace:hover {
            background-color: #e0a800;
        }
        .btn-remove {
            background-color: #dc3545;
        }
        .btn-remove:hover {
            background-color: #c82333;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .controls button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s ease;
        }
        .controls button:hover {
            background-color: #0056b3;
        }
        .controls button.download-btn {
            background-color: #6c757d;
        }
        .controls button.download-btn:hover {
            background-color: #5a6268;
        }
        .current-pick-info {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: bold;
            color: #007bff;
        }
        .setup-screen {
            width: 80%;
            max-width: 600px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .setup-screen h1 {
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .setup-form {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        .start-draft-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            margin-top: 20px;
            transition: background-color 0.2s ease;
        }
        .start-draft-btn:hover {
            background-color: #218838;
        }
        .hidden {
            display: none;
        }
        .team1 {
            background-color: #e7f3ff;
        }
        .team2 {
            background-color: #ffebeb;
        }
        .add-players-btn {
            background-color: #17a2b8;
            margin-bottom: 15px;
        }
        .add-players-btn:hover {
            background-color: #138496;
        }
        .player-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .player-input-container input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .player-input-container button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        .position-filled {
            background-color: #d4edda;
        }
        .position-actions {
            display: flex;
            gap: 5px;
        }
        .manager-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .manager-name {
            font-weight: bold;
        }
        .manager-actions {
            display: flex;
            gap: 5px;
        }
    </style>
</head>
<body>
    <!-- Pantalla de configuración inicial -->
    <div id="setupScreen" class="setup-screen">
        <h1>Configuración del Draft</h1>
        <div class="setup-form">
            <div class="form-group">
                <label for="team1Name">Nombre del Equipo 1:</label>
                <input type="text" id="team1Name" placeholder="Ej: Los Tigres" required>
            </div>
            <div class="form-group">
                <label for="team2Name">Nombre del Equipo 2:</label>
                <input type="text" id="team2Name" placeholder="Ej: Las Águilas" required>
            </div>
            <div class="form-group">
                <label for="playerList">Lista de Jugadores (uno por línea o separados por comas):</label>
                <textarea id="playerList" placeholder="Ej: Juan Pérez&#10;Carlos Gómez&#10;María Rodríguez&#10;Luis Hernández&#10;Ana Torres&#10;Pedro Díaz&#10;Laura Soto&#10;Miguel Reyes&#10;Sofía Vargas&#10;Roberto Cruz&#10;Elena Ramos&#10;Andrés Castro&#10;Gabriela Gil&#10;Fernando Vega&#10;Isabel Núñez&#10;Diego Molina&#10;Valeria Pineda&#10;José Ortiz&#10;Camila Blanco&#10;Ricardo Marín" required></textarea>
            </div>
            <div class="form-group">
                <label for="managerList">Lista de Managers (uno por línea o separados por comas):</label>
                <textarea id="managerList" placeholder="Ej: Manager A&#10;Manager B&#10;Manager C" required></textarea>
            </div>
        </div>
        <button id="startDraftBtn" class="start-draft-btn">Comenzar Draft</button>
    </div>

    <!-- Pantalla principal del draft (inicialmente oculta) -->
    <div id="draftScreen" class="hidden">
        <h1>Simulador de Draft de Softball</h1>
        <p class="current-pick-info" id="currentPickInfo">Es el turno del <span id="currentTeamName"></span> para elegir.</p>

        <div class="draft-container">
            <!-- Equipo 1 -->
            <div class="team-panel team1">
                <h2 id="team1Title">Equipo 1</h2>
                
                <div class="manager-section">
                    <div>
                        <span>Manager: </span>
                        <span class="manager-name" id="team1-manager">(Sin asignar)</span>
                    </div>
                    <div class="manager-actions">
                        <button class="btn btn-select" onclick="startSelectManager(1)">Asignar</button>
                        <button class="btn btn-remove" onclick="removeManager(1)" id="team1-remove-manager" style="display: none;">Eliminar</button>
                    </div>
                </div>
                
                <table id="team1Table">
                    <thead>
                        <tr>
                            <th>Posición</th>
                            <th>Jugador</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Pitcher</td>
                            <td id="team1-pitcher"></td>
                            <td class="position-actions" id="team1-pitcher-actions"></td>
                        </tr>
                        <tr>
                            <td>Catcher</td>
                            <td id="team1-catcher"></td>
                            <td class="position-actions" id="team1-catcher-actions"></td>
                        </tr>
                        <tr>
                            <td>1ra Base</td>
                            <td id="team1-firstBase"></td>
                            <td class="position-actions" id="team1-firstBase-actions"></td>
                        </tr>
                        <tr>
                            <td>2da Base</td>
                            <td id="team1-secondBase"></td>
                            <td class="position-actions" id="team1-secondBase-actions"></td>
                        </tr>
                        <tr>
                            <td>3ra Base</td>
                            <td id="team1-thirdBase"></td>
                            <td class="position-actions" id="team1-thirdBase-actions"></td>
                        </tr>
                        <tr>
                            <td>Shortstop</td>
                            <td id="team1-shortstop"></td>
                            <td class="position-actions" id="team1-shortstop-actions"></td>
                        </tr>
                        <tr>
                            <td>J. Izquierdo</td>
                            <td id="team1-leftField"></td>
                            <td class="position-actions" id="team1-leftField-actions"></td>
                        </tr>
                        <tr>
                            <td>J. Central</td>
                            <td id="team1-centerField"></td>
                            <td class="position-actions" id="team1-centerField-actions"></td>
                        </tr>
                        <tr>
                            <td>J. Derecho</td>
                            <td id="team1-rightField"></td>
                            <td class="position-actions" id="team1-rightField-actions"></td>
                        </tr>
                        <tr>
                            <td>DH/Extras</td>
                            <td id="team1-extra"></td>
                            <td class="position-actions" id="team1-extra-actions"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Jugadores disponibles en el centro -->
            <div class="player-pool">
                <h2 id="selectionTitle">Jugadores Disponibles</h2>
                <div id="selectionContainer">
                    <button id="addPlayersBtn" class="controls button add-players-btn" onclick="showAddPlayers()">Agregar más jugadores</button>
                    <div id="addPlayersSection" class="hidden">
                        <div class="player-input-container">
                            <input type="text" id="newPlayerName" placeholder="Nombre del jugador">
                            <button onclick="addNewPlayer()">Agregar</button>
                        </div>
                    </div>
                    <ul id="availablePlayers" class="player-list">
                        <!-- Jugadores se cargarán aquí -->
                    </ul>
                </div>
            </div>

            <!-- Equipo 2 -->
            <div class="team-panel team2">
                <h2 id="team2Title">Equipo 2</h2>
                
                <div class="manager-section">
                    <div>
                        <span>Manager: </span>
                        <span class="manager-name" id="team2-manager">(Sin asignar)</span>
                    </div>
                    <div class="manager-actions">
                        <button class="btn btn-select" onclick="startSelectManager(2)">Asignar</button>
                        <button class="btn btn-remove" onclick="removeManager(2)" id="team2-remove-manager" style="display: none;">Eliminar</button>
                    </div>
                </div>
                
                <table id="team2Table">
                    <thead>
                        <tr>
                            <th>Posición</th>
                            <th>Jugador</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Pitcher</td>
                            <td id="team2-pitcher"></td>
                            <td class="position-actions" id="team2-pitcher-actions"></td>
                        </tr>
                        <tr>
                            <td>Catcher</td>
                            <td id="team2-catcher"></td>
                            <td class="position-actions" id="team2-catcher-actions"></td>
                        </tr>
                        <tr>
                            <td>1ra Base</td>
                            <td id="team2-firstBase"></td>
                            <td class="position-actions" id="team2-firstBase-actions"></td>
                        </tr>
                        <tr>
                            <td>2da Base</td>
                            <td id="team2-secondBase"></td>
                            <td class="position-actions" id="team2-secondBase-actions"></td>
                        </tr>
                        <tr>
                            <td>3ra Base</td>
                            <td id="team2-thirdBase"></td>
                            <td class="position-actions" id="team2-thirdBase-actions"></td>
                        </tr>
                        <tr>
                            <td>Shortstop</td>
                            <td id="team2-shortstop"></td>
                            <td class="position-actions" id="team2-shortstop-actions"></td>
                        </tr>
                        <tr>
                            <td>J. Izquierdo</td>
                            <td id="team2-leftField"></td>
                            <td class="position-actions" id="team2-leftField-actions"></td>
                        </tr>
                        <tr>
                            <td>J. Central</td>
                            <td id="team2-centerField"></td>
                            <td class="position-actions" id="team2-centerField-actions"></td>
                        </tr>
                        <tr>
                            <td>J. Derecho</td>
                            <td id="team2-rightField"></td>
                            <td class="position-actions" id="team2-rightField-actions"></td>
                        </tr>
                        <tr>
                            <td>DH/Extras</td>
                            <td id="team2-extra"></td>
                            <td class="position-actions" id="team2-extra-actions"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="controls">
            <button onclick="resetDraft()">Reiniciar Draft</button>
            <button class="download-btn" onclick="downloadPDF()">Descargar Selecciones (PDF)</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Variables globales
        let allPlayers = [];
        let availablePlayers = [];
        let allManagers = [];
        let availableManagers = [];
        let team1 = {
            name: "Equipo 1",
            manager: null,
            players: {},
            extras: []
        };
        let team2 = {
            name: "Equipo 2",
            manager: null,
            players: {},
            extras: []
        };
        let currentPickingTeam = 1;
        let currentPosition = null;
        let currentTeamForSelection = null;
        let selectingManager = false;

        // Posiciones de softball
        const positions = [
            { id: "pitcher", name: "Pitcher" },
            { id: "catcher", name: "Catcher" },
            { id: "firstBase", name: "1ra Base" },
            { id: "secondBase", name: "2da Base" },
            { id: "thirdBase", name: "3ra Base" },
            { id: "shortstop", name: "Shortstop" },
            { id: "leftField", name: "J. Izquierdo" },
            { id: "centerField", name: "J. Central" },
            { id: "rightField", name: "J. Derecho" },
            { id: "extra", name: "DH/Extra" }
        ];

        // Elementos del DOM
        const setupScreen = document.getElementById('setupScreen');
        const draftScreen = document.getElementById('draftScreen');
        const team1NameInput = document.getElementById('team1Name');
        const team2NameInput = document.getElementById('team2Name');
        const playerListInput = document.getElementById('playerList');
        const managerListInput = document.getElementById('managerList');
        const startDraftBtn = document.getElementById('startDraftBtn');
        const currentPickInfo = document.getElementById('currentPickInfo');
        const currentTeamNameSpan = document.getElementById('currentTeamName');
        const team1Title = document.getElementById('team1Title');
        const team2Title = document.getElementById('team2Title');
        const availablePlayersUl = document.getElementById('availablePlayers');
        const addPlayersBtn = document.getElementById('addPlayersBtn');
        const addPlayersSection = document.getElementById('addPlayersSection');
        const newPlayerNameInput = document.getElementById('newPlayerName');
        const selectionTitle = document.getElementById('selectionTitle');
        const selectionContainer = document.getElementById('selectionContainer');

        // Inicializar el draft
        function initializeDraft() {
            // Obtener nombres de equipos
            team1.name = team1NameInput.value || "Equipo 1";
            team2.name = team2NameInput.value || "Equipo 2";
            
            // Actualizar títulos
            team1Title.textContent = team1.name;
            team2Title.textContent = team2.name;
            
            // Obtener lista de jugadores
            const playersText = playerListInput.value;
            allPlayers = playersText.split(/[\n,]/)
                .map(player => player.trim())
                .filter(player => player !== "");
            
            // Obtener lista de managers
            const managersText = managerListInput.value;
            allManagers = managersText.split(/[\n,]/)
                .map(manager => manager.trim())
                .filter(manager => manager !== "");
            
            // Si no hay jugadores ingresados, usar los predeterminados
            if (allPlayers.length === 0) {
                allPlayers = [
                    "Juan Pérez", "Carlos Gómez", "María Rodríguez", "Luis Hernández", 
                    "Ana Torres", "Pedro Díaz", "Laura Soto", "Miguel Reyes", 
                    "Sofía Vargas", "Roberto Cruz", "Elena Ramos", "Andrés Castro", 
                    "Gabriela Gil", "Fernando Vega", "Isabel Núñez", "Diego Molina", 
                    "Valeria Pineda", "José Ortiz", "Camila Blanco", "Ricardo Marín"
                ];
            }
            
            // Si no hay managers ingresados, usar predeterminados
            if (allManagers.length === 0) {
                allManagers = ["Manager A", "Manager B", "Manager C"];
            }
            
            // Inicializar listas
            availablePlayers = [...allPlayers];
            availableManagers = [...allManagers];
            
            // Inicializar jugadores de los equipos
            positions.forEach(pos => {
                if (pos.id !== 'extra') {
                    team1.players[pos.id] = null;
                    team2.players[pos.id] = null;
                }
            });
            team1.extras = [];
            team2.extras = [];
            team1.manager = null;
            team2.manager = null;
            
            // Actualizar tablas de equipos
            updateTeamTables();
            updateManagersDisplay();
            
            // Actualizar lista de jugadores disponibles
            updateAvailablePlayers();
            
            // Actualizar información del turno
            updateTurnInfo();
            
            // Mostrar pantalla del draft
            setupScreen.classList.add('hidden');
            draftScreen.classList.remove('hidden');
        }

        // Actualizar las tablas de los equipos
        function updateTeamTables() {
            positions.forEach(pos => {
                if (pos.id !== 'extra') {
                    updatePositionCell(1, pos.id);
                    updatePositionCell(2, pos.id);
                } else {
                    updateExtrasCell(1);
                    updateExtrasCell(2);
                }
            });
        }

        // Actualizar visualización de managers
        function updateManagersDisplay() {
            const team1Manager = document.getElementById('team1-manager');
            const team2Manager = document.getElementById('team2-manager');
            const team1RemoveBtn = document.getElementById('team1-remove-manager');
            const team2RemoveBtn = document.getElementById('team2-remove-manager');
            
            if (team1.manager) {
                team1Manager.textContent = team1.manager;
                team1RemoveBtn.style.display = 'inline-block';
            } else {
                team1Manager.textContent = "(Sin asignar)";
                team1RemoveBtn.style.display = 'none';
            }
            
            if (team2.manager) {
                team2Manager.textContent = team2.manager;
                team2RemoveBtn.style.display = 'inline-block';
            } else {
                team2Manager.textContent = "(Sin asignar)";
                team2RemoveBtn.style.display = 'none';
            }
        }

        // Actualizar una celda de posición
        function updatePositionCell(team, positionId) {
            const cell = document.getElementById(`team${team}-${positionId}`);
            const actionsCell = document.getElementById(`team${team}-${positionId}-actions`);
            
            const teamObj = team === 1 ? team1 : team2;
            const player = teamObj.players[positionId];
            
            if (player) {
                cell.textContent = player;
                cell.classList.add('position-filled');
                
                // Botones para posiciones ocupadas
                actionsCell.innerHTML = `
                    <button class="btn btn-replace" onclick="startReplacePlayer('${positionId}', ${team})">Reemplazar</button>
                    <button class="btn btn-remove" onclick="removePlayer('${positionId}', ${team})">Eliminar</button>
                `;
            } else {
                cell.textContent = "(Vacante)";
                cell.classList.remove('position-filled');
                
                // Botón para posiciones vacantes
                actionsCell.innerHTML = `
                    <button class="btn btn-select" onclick="startSelectPlayer('${positionId}', ${team})">Seleccionar</button>
                `;
            }
        }

        // Actualizar celda de extras
        function updateExtrasCell(team) {
            const cell = document.getElementById(`team${team}-extra`);
            const actionsCell = document.getElementById(`team${team}-extra-actions`);
            const teamObj = team === 1 ? team1 : team2;
            
            if (teamObj.extras.length > 0) {
                cell.textContent = teamObj.extras.join(", ");
                cell.classList.add('position-filled');
                
                // Botones para extras
                actionsCell.innerHTML = `
                    <button class="btn btn-select" onclick="startAddExtra(${team})">Agregar</button>
                    <button class="btn btn-remove" onclick="clearExtras(${team})">Limpiar</button>
                `;
            } else {
                cell.textContent = "(Vacante)";
                cell.classList.remove('position-filled');
                
                // Botón para extras vacíos
                actionsCell.innerHTML = `
                    <button class="btn btn-select" onclick="startAddExtra(${team})">Agregar</button>
                `;
            }
        }

        // Iniciar selección de manager
        function startSelectManager(team) {
            selectingManager = true;
            currentTeamForSelection = team;
            showManagerSelection();
        }

        // Mostrar selección de managers
        function showManagerSelection() {
            selectionTitle.textContent = "Seleccionar Manager";
            
            // Limpiar selección previa
            selectionContainer.innerHTML = '';
            
            if (availableManagers.length === 0) {
                const message = document.createElement('p');
                message.textContent = "No hay managers disponibles";
                selectionContainer.appendChild(message);
            } else {
                const managerList = document.createElement('ul');
                managerList.className = 'player-list';
                
                availableManagers.forEach(manager => {
                    const li = document.createElement('li');
                    li.textContent = manager;
                    
                    const selectBtn = document.createElement('button');
                    selectBtn.className = 'btn btn-select';
                    selectBtn.textContent = 'Seleccionar';
                    selectBtn.onclick = () => assignManager(manager);
                    
                    li.appendChild(selectBtn);
                    managerList.appendChild(li);
                });
                
                selectionContainer.appendChild(managerList);
            }
        }

        // Asignar manager a un equipo
        function assignManager(manager) {
            const team = currentTeamForSelection;
            const teamObj = team === 1 ? team1 : team2;
            
            // Si ya tenía manager, lo liberamos
            if (teamObj.manager) {
                availableManagers.push(teamObj.manager);
            }
            
            // Asignar nuevo manager
            teamObj.manager = manager;
            
            // Eliminar manager de la lista de disponibles
            const index = availableManagers.indexOf(manager);
            if (index !== -1) {
                availableManagers.splice(index, 1);
            }
            
            // Resetear selección
            selectingManager = false;
            currentTeamForSelection = null;
            
            // Actualizar UI
            updateManagersDisplay();
            updateAvailablePlayers();
            selectionTitle.textContent = "Jugadores Disponibles";
        }

        // Eliminar manager de un equipo
        function removeManager(team) {
            const teamObj = team === 1 ? team1 : team2;
            
            if (teamObj.manager) {
                availableManagers.push(teamObj.manager);
                teamObj.manager = null;
                
                // Actualizar UI
                updateManagersDisplay();
            }
        }

        // Iniciar selección de jugador para una posición
        function startSelectPlayer(positionId, team) {
            if (currentPickingTeam !== team) {
                alert(`No es el turno de ${team === 1 ? team1.name : team2.name}. Es el turno de ${currentPickingTeam === 1 ? team1.name : team2.name}.`);
                return;
            }
            
            selectingManager = false;
            currentPosition = positionId;
            currentTeamForSelection = team;
            showPlayerSelection();
        }

        // Iniciar reemplazo de jugador
        function startReplacePlayer(positionId, team) {
            currentPosition = positionId;
            currentTeamForSelection = team;
            selectingManager = false;
            showPlayerSelection();
        }

        // Iniciar adición de extra
        function startAddExtra(team) {
            currentPosition = 'extra';
            currentTeamForSelection = team;
            selectingManager = false;
            showPlayerSelection();
        }

        // Mostrar selección de jugadores
        function showPlayerSelection() {
            selectionTitle.textContent = "Jugadores Disponibles";
            
            // Limpiar selección previa
            selectionContainer.innerHTML = '';
            
            const addPlayersBtn = document.createElement('button');
            addPlayersBtn.className = 'controls button add-players-btn';
            addPlayersBtn.textContent = 'Agregar más jugadores';
            addPlayersBtn.onclick = showAddPlayers;
            selectionContainer.appendChild(addPlayersBtn);
            
            const addPlayersSection = document.createElement('div');
            addPlayersSection.id = 'addPlayersSection';
            addPlayersSection.className = 'hidden';
            addPlayersSection.innerHTML = `
                <div class="player-input-container">
                    <input type="text" id="newPlayerName" placeholder="Nombre del jugador">
                    <button onclick="addNewPlayer()">Agregar</button>
                </div>
            `;
            selectionContainer.appendChild(addPlayersSection);
            
            const playerList = document.createElement('ul');
            playerList.className = 'player-list';
            
            if (availablePlayers.length === 0) {
                const li = document.createElement('li');
                li.textContent = "No hay jugadores disponibles";
                playerList.appendChild(li);
            } else {
                availablePlayers.forEach(player => {
                    const li = document.createElement('li');
                    li.textContent = player;
                    
                    const selectBtn = document.createElement('button');
                    selectBtn.className = 'btn btn-select';
                    selectBtn.textContent = 'Seleccionar';
                    selectBtn.onclick = () => assignPlayerToPosition(player);
                    
                    li.appendChild(selectBtn);
                    playerList.appendChild(li);
                });
            }
            
            selectionContainer.appendChild(playerList);
        }

        // Asignar jugador a una posición
        function assignPlayerToPosition(player) {
            if (!currentPosition || !currentTeamForSelection) return;
            
            const team = currentTeamForSelection;
            const teamObj = team === 1 ? team1 : team2;
            
            // Verificar que el jugador no esté ya en el equipo (excepto para extras)
            if (currentPosition !== 'extra') {
                if (Object.values(teamObj.players).includes(player) || teamObj.extras.includes(player)) {
                    alert("Este jugador ya está en el equipo.");
                    return;
                }
                
                // Si es reemplazo, liberar al jugador anterior
                if (teamObj.players[currentPosition]) {
                    availablePlayers.push(teamObj.players[currentPosition]);
                }
                
                // Asignar nuevo jugador
                teamObj.players[currentPosition] = player;
                
                // Eliminar jugador de la lista de disponibles
                const index = availablePlayers.indexOf(player);
                if (index !== -1) {
                    availablePlayers.splice(index, 1);
                }
                
                // Cambiar turno
                currentPickingTeam = currentPickingTeam === 1 ? 2 : 1;
            } else {
                // Para extras
                if (teamObj.extras.includes(player)) {
                    alert("Este jugador ya está en los extras.");
                    return;
                }
                
                teamObj.extras.push(player);
                // No cambia el turno para extras
            }
            
            // Resetear selección
            currentPosition = null;
            currentTeamForSelection = null;
            
            // Actualizar UI
            updateTeamTables();
            updateAvailablePlayers();
            updateTurnInfo();
        }

        // Eliminar jugador de una posición
        function removePlayer(positionId, team) {
            const teamObj = team === 1 ? team1 : team2;
            
            if (teamObj.players[positionId]) {
                availablePlayers.push(teamObj.players[positionId]);
                teamObj.players[positionId] = null;
                
                // Actualizar UI
                updateTeamTables();
                updateAvailablePlayers();
            }
        }

        // Limpiar extras
        function clearExtras(team) {
            const teamObj = team === 1 ? team1 : team2;
            
            if (teamObj.extras.length > 0) {
                availablePlayers.push(...teamObj.extras);
                teamObj.extras = [];
                
                // Actualizar UI
                updateTeamTables();
                updateAvailablePlayers();
            }
        }

        // Actualizar lista de jugadores disponibles
        function updateAvailablePlayers() {
            if (selectingManager) return;
            
            const playerListContainer = document.querySelector('#selectionContainer ul');
            if (!playerListContainer) return;
            
            playerListContainer.innerHTML = '';
            if (availablePlayers.length === 0) {
                const li = document.createElement('li');
                li.textContent = "No hay jugadores disponibles";
                playerListContainer.appendChild(li);
            } else {
                availablePlayers.forEach(player => {
                    const li = document.createElement('li');
                    li.textContent = player;
                    
                    const selectBtn = document.createElement('button');
                    selectBtn.className = 'btn btn-select';
                    selectBtn.textContent = 'Seleccionar';
                    selectBtn.onclick = () => assignPlayerToPosition(player);
                    
                    li.appendChild(selectBtn);
                    playerListContainer.appendChild(li);
                });
            }
        }

        // Actualizar información del turno
        function updateTurnInfo() {
            const currentTeam = currentPickingTeam === 1 ? team1 : team2;
            currentTeamNameSpan.textContent = currentTeam.name;
            currentTeamNameSpan.style.color = currentPickingTeam === 1 ? '#007bff' : '#dc3545';
            currentPickInfo.textContent = `Es el turno de ${currentTeam.name} para elegir.`;
        }

        // Mostrar sección para agregar jugadores
        function showAddPlayers() {
            const addPlayersSection = document.getElementById('addPlayersSection');
            addPlayersSection.classList.toggle('hidden');
        }

        // Agregar nuevo jugador
        function addNewPlayer() {
            const playerName = document.getElementById('newPlayerName').value.trim();
            if (playerName === "") {
                alert("Por favor ingresa un nombre válido.");
                return;
            }
            
            if (allPlayers.includes(playerName)) {
                alert("Este jugador ya existe.");
                return;
            }
            
            allPlayers.push(playerName);
            availablePlayers.push(playerName);
            
            document.getElementById('newPlayerName').value = "";
            updateAvailablePlayers();
            document.getElementById('addPlayersSection').classList.add('hidden');
        }

        // Reiniciar el draft
        function resetDraft() {
            if (confirm('¿Estás seguro que quieres reiniciar el draft? Se perderán todos los jugadores elegidos.')) {
                setupScreen.classList.remove('hidden');
                draftScreen.classList.add('hidden');
            }
        }

        // Descargar PDF con las selecciones
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            let yOffset = 20;
            const lineHeight = 10;

            doc.setFontSize(20);
            doc.text("Resultados del Draft de Softball", 105, yOffset, null, null, "center");
            yOffset += 20;

            // Equipo 1
            doc.setFontSize(16);
            doc.text(`${team1.name}:`, 20, yOffset);
            yOffset += lineHeight;
            
            doc.setFontSize(12);
            doc.text(`Manager: ${team1.manager || "No asignado"}`, 25, yOffset);
            yOffset += lineHeight;
            
            let hasPlayers1 = false;
            positions.forEach(pos => {
                if (pos.id !== 'extra') {
                    if (team1.players[pos.id]) {
                        doc.text(`- ${pos.name}: ${team1.players[pos.id]}`, 25, yOffset);
                        yOffset += lineHeight;
                        hasPlayers1 = true;
                    }
                } else {
                    if (team1.extras.length > 0) {
                        doc.text(`- ${pos.name}: ${team1.extras.join(", ")}`, 25, yOffset);
                        yOffset += lineHeight;
                        hasPlayers1 = true;
                    }
                }
            });
            
            if (!hasPlayers1) {
                doc.text("No hay jugadores seleccionados.", 25, yOffset);
                yOffset += lineHeight;
            }
            
            yOffset += 10;

            // Equipo 2
            doc.setFontSize(16);
            doc.text(`${team2.name}:`, 20, yOffset);
            yOffset += lineHeight;
            
            doc.setFontSize(12);
            doc.text(`Manager: ${team2.manager || "No asignado"}`, 25, yOffset);
            yOffset += lineHeight;
            
            let hasPlayers2 = false;
            positions.forEach(pos => {
                if (pos.id !== 'extra') {
                    if (team2.players[pos.id]) {
                        doc.text(`- ${pos.name}: ${team2.players[pos.id]}`, 25, yOffset);
                        yOffset += lineHeight;
                        hasPlayers2 = true;
                    }
                } else {
                    if (team2.extras.length > 0) {
                        doc.text(`- ${pos.name}: ${team2.extras.join(", ")}`, 25, yOffset);
                        yOffset += lineHeight;
                        hasPlayers2 = true;
                    }
                }
            });
            
            if (!hasPlayers2) {
                doc.text("No hay jugadores seleccionados.", 25, yOffset);
                yOffset += lineHeight;
            }

            doc.save(`Draft_Softball_${team1.name}_vs_${team2.name}.pdf`);
        }

        // Event listeners
        startDraftBtn.addEventListener('click', initializeDraft);

        // Permitir iniciar con Enter en los campos de texto
        team1NameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') initializeDraft();
        });
        team2NameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') initializeDraft();
        });
        playerListInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') initializeDraft();
        });
        managerListInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') initializeDraft();
        });
    </script>
</body>
</html>
