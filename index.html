<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draft de Softball</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .draft-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 1400px;
            margin-top: 20px;
            gap: 20px;
        }
        .team-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 35%;
        }
        .players-center {
            width: 30%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .player-pool {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            width: 100%;
            margin-bottom: 20px;
        }
        h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }
        .player-list {
            list-style: none;
            padding: 0;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
        }
        .player-list li {
            background-color: #e9ecef;
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 5px;
            cursor: grab;
            transition: all 0.2s ease;
        }
        .player-list li:hover {
            background-color: #d0d7dd;
            transform: scale(1.01);
        }
        .player-list li.dragging {
            opacity: 0.5;
            background-color: #b8c2cc;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .controls button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s ease;
        }
        .controls button:hover {
            background-color: #0056b3;
        }
        .controls button.download-btn {
            background-color: #6c757d;
        }
        .controls button.download-btn:hover {
            background-color: #5a6268;
        }
        .current-pick-info {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: bold;
            color: #007bff;
        }
        .setup-screen {
            width: 80%;
            max-width: 600px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .setup-screen h1 {
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .setup-form {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        .start-draft-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            margin-top: 20px;
            transition: background-color 0.2s ease;
        }
        .start-draft-btn:hover {
            background-color: #218838;
        }
        .hidden {
            display: none;
        }
        .add-players-btn {
            background-color: #17a2b8;
            margin-bottom: 15px;
        }
        .add-players-btn:hover {
            background-color: #138496;
        }
        .player-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .player-input-container input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .player-input-container button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        .drop-target {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .drop-target.highlight {
            background-color: #d4edda !important;
        }
        .drop-target.filled {
            background-color: #d4edda;
        }
        .field-container {
            position: relative;
            width: 350px;
            height: 350px;
            background-color: #8bc34a;
            border-radius: 50%;
            margin-bottom: 20px;
            border: 3px solid #5a9216;
            overflow: hidden;
        }
        .field-position {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.7);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            border: 2px solid #5a9216;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .field-position:hover {
            transform: scale(1.05);
        }
        .field-position.filled {
            background-color: #4CAF50;
            color: white;
        }
        .player-name {
            font-size: 10px;
            margin-top: 3px;
            font-weight: normal;
            word-break: break-word;
            max-width: 50px;
        }
        .team-title {
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            border-radius: 5px;
            width: 100%;
            text-align: center;
            margin-bottom: 10px;
        }
        .team1-title {
            background-color: #007bff;
        }
        .team2-title {
            background-color: #dc3545;
        }
    </style>
</head>
<body>
    <!-- Pantalla de configuración inicial -->
    <div id="setupScreen" class="setup-screen">
        <h1>Configuración del Draft</h1>
        <div class="setup-form">
            <div class="form-group">
                <label for="team1Name">Nombre del Equipo 1:</label>
                <input type="text" id="team1Name" placeholder="Ej: Los Tigres" required>
            </div>
            <div class="form-group">
                <label for="team2Name">Nombre del Equipo 2:</label>
                <input type="text" id="team2Name" placeholder="Ej: Las Águilas" required>
            </div>
            <div class="form-group">
                <label for="playerList">Lista de Jugadores (uno por línea o separados por comas):</label>
                <textarea id="playerList" placeholder="Ej: Juan Pérez&#10;Carlos Gómez&#10;María Rodríguez&#10;Luis Hernández&#10;Ana Torres&#10;Pedro Díaz&#10;Laura Soto&#10;Miguel Reyes&#10;Sofía Vargas&#10;Roberto Cruz&#10;Elena Ramos&#10;Andrés Castro&#10;Gabriela Gil&#10;Fernando Vega&#10;Isabel Núñez&#10;Diego Molina&#10;Valeria Pineda&#10;José Ortiz&#10;Camila Blanco&#10;Ricardo Marín" required></textarea>
            </div>
        </div>
        <button id="startDraftBtn" class="start-draft-btn">Comenzar Draft</button>
    </div>

    <!-- Pantalla principal del draft (inicialmente oculta) -->
    <div id="draftScreen" class="hidden">
        <h1>Simulador de Draft de Softball</h1>
        <p class="current-pick-info" id="currentPickInfo">Es el turno del <span id="currentTeamName"></span> para elegir.</p>

        <div class="draft-container">
            <!-- Equipo 1 -->
            <div class="team-container">
                <div class="team-title team1-title" id="team1Title">Equipo 1</div>
                <div class="field-container" id="team1Field">
                    <!-- Posiciones se generarán dinámicamente -->
                </div>
                <div class="extras-container">
                    <h3>DH/Extras</h3>
                    <div id="team1-extras" class="drop-target" ondrop="dropPlayer(event, 'extra', 1)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" style="min-height: 60px; border: 2px dashed #5a9216; border-radius: 5px; padding: 10px;"></div>
                </div>
            </div>

            <!-- Jugadores disponibles en el centro -->
            <div class="players-center">
                <div class="player-pool">
                    <h2>Jugadores Disponibles</h2>
                    <button id="addPlayersBtn" class="controls button add-players-btn" onclick="showAddPlayers()">Agregar más jugadores</button>
                    <div id="addPlayersSection" class="hidden">
                        <div class="player-input-container">
                            <input type="text" id="newPlayerName" placeholder="Nombre del jugador">
                            <button onclick="addNewPlayer()">Agregar</button>
                        </div>
                    </div>
                    <ul id="availablePlayers" class="player-list">
                        <!-- Jugadores se cargarán aquí -->
                    </ul>
                </div>
            </div>

            <!-- Equipo 2 -->
            <div class="team-container">
                <div class="team-title team2-title" id="team2Title">Equipo 2</div>
                <div class="field-container" id="team2Field">
                    <!-- Posiciones se generarán dinámicamente -->
                </div>
                <div class="extras-container">
                    <h3>DH/Extras</h3>
                    <div id="team2-extras" class="drop-target" ondrop="dropPlayer(event, 'extra', 2)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)" style="min-height: 60px; border: 2px dashed #5a9216; border-radius: 5px; padding: 10px;"></div>
                </div>
            </div>
        </div>

        <div class="controls">
            <button onclick="resetDraft()">Reiniciar Draft</button>
            <button class="download-btn" onclick="downloadPDF()">Descargar Selecciones (PDF)</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Variables globales
        let allPlayers = [];
        let availablePlayers = [];
        let team1 = {
            name: "Equipo 1",
            players: {},
            extras: []
        };
        let team2 = {
            name: "Equipo 2",
            players: {},
            extras: []
        };
        let currentPickingTeam = 1;
        let draggedPlayer = null;

        // Posiciones de softball con coordenadas en el campo
        const positions = [
            { id: "pitcher", name: "Pitcher", x: 50, y: 50 },
            { id: "catcher", name: "Catcher", x: 50, y: 80 },
            { id: "firstBase", name: "1B", x: 80, y: 20 },
            { id: "secondBase", name: "2B", x: 50, y: 30 },
            { id: "thirdBase", name: "3B", x: 20, y: 20 },
            { id: "shortstop", name: "SS", x: 40, y: 20 },
            { id: "leftField", name: "LF", x: 20, y: 70 },
            { id: "centerField", name: "CF", x: 50, y: 10 },
            { id: "rightField", name: "RF", x: 80, y: 70 }
        ];

        // Elementos del DOM
        const setupScreen = document.getElementById('setupScreen');
        const draftScreen = document.getElementById('draftScreen');
        const team1NameInput = document.getElementById('team1Name');
        const team2NameInput = document.getElementById('team2Name');
        const playerListInput = document.getElementById('playerList');
        const startDraftBtn = document.getElementById('startDraftBtn');
        const currentPickInfo = document.getElementById('currentPickInfo');
        const currentTeamNameSpan = document.getElementById('currentTeamName');
        const team1Title = document.getElementById('team1Title');
        const team2Title = document.getElementById('team2Title');
        const availablePlayersUl = document.getElementById('availablePlayers');
        const addPlayersBtn = document.getElementById('addPlayersBtn');
        const addPlayersSection = document.getElementById('addPlayersSection');
        const newPlayerNameInput = document.getElementById('newPlayerName');
        const team1Field = document.getElementById('team1Field');
        const team2Field = document.getElementById('team2Field');

        // Inicializar el draft
        function initializeDraft() {
            // Obtener nombres de equipos
            team1.name = team1NameInput.value || "Equipo 1";
            team2.name = team2NameInput.value || "Equipo 2";
            
            // Actualizar títulos
            team1Title.textContent = team1.name;
            team2Title.textContent = team2.name;
            
            // Obtener lista de jugadores
            const playersText = playerListInput.value;
            // Dividir por líneas o comas
            allPlayers = playersText.split(/[\n,]/)
                .map(player => player.trim())
                .filter(player => player !== "");
            
            // Si no hay jugadores ingresados, usar los predeterminados
            if (allPlayers.length === 0) {
                allPlayers = [
                    "Juan Pérez", "Carlos Gómez", "María Rodríguez", "Luis Hernández", 
                    "Ana Torres", "Pedro Díaz", "Laura Soto", "Miguel Reyes", 
                    "Sofía Vargas", "Roberto Cruz", "Elena Ramos", "Andrés Castro", 
                    "Gabriela Gil", "Fernando Vega", "Isabel Núñez", "Diego Molina", 
                    "Valeria Pineda", "José Ortiz", "Camila Blanco", "Ricardo Marín"
                ];
            }
            
            // Inicializar listas de jugadores
            availablePlayers = [...allPlayers];
            
            // Inicializar jugadores de los equipos
            positions.forEach(pos => {
                team1.players[pos.id] = null;
                team2.players[pos.id] = null;
            });
            team1.extras = [];
            team2.extras = [];
            
            // Crear campos visuales
            createFieldVisualization();
            
            // Actualizar lista de jugadores disponibles
            updateAvailablePlayers();
            
            // Actualizar información del turno
            updateTurnInfo();
            
            // Mostrar pantalla del draft
            setupScreen.classList.add('hidden');
            draftScreen.classList.remove('hidden');
        }

        // Crear la visualización del campo para ambos equipos
        function createFieldVisualization() {
            team1Field.innerHTML = '';
            team2Field.innerHTML = '';
            
            // Base paths (diamonds)
            createBasePath(team1Field);
            createBasePath(team2Field);
            
            // Posiciones
            positions.forEach(pos => {
                createPositionElement(team1Field, pos, 1);
                createPositionElement(team2Field, pos, 2);
            });
            
            // Actualizar extras
            updateExtrasDisplay();
        }

        // Crear el diamante de bases
        function createBasePath(container) {
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("width", "100%");
            svg.setAttribute("height", "100%");
            svg.setAttribute("viewBox", "0 0 100 100");
            svg.style.position = "absolute";
            svg.style.top = "0";
            svg.style.left = "0";
            
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute("d", "M50,80 L80,50 L50,20 L20,50 Z");
            path.setAttribute("stroke", "#5a9216");
            path.setAttribute("stroke-width", "2");
            path.setAttribute("fill", "none");
            
            svg.appendChild(path);
            container.appendChild(svg);
        }

        // Crear elemento de posición en el campo
        function createPositionElement(container, pos, team) {
            const positionElement = document.createElement('div');
            positionElement.className = 'field-position';
            positionElement.id = `team${team}-${pos.id}`;
            positionElement.style.left = `${pos.x}%`;
            positionElement.style.top = `${pos.y}%`;
            positionElement.dataset.position = pos.id;
            positionElement.dataset.team = team;
            positionElement.innerHTML = `<div>${pos.name}</div><div class="player-name"></div>`;
            
            positionElement.addEventListener('dragover', allowDrop);
            positionElement.addEventListener('dragleave', dragLeave);
            positionElement.addEventListener('drop', (e) => dropPlayer(e, pos.id, team));
            
            container.appendChild(positionElement);
        }

        // Actualizar extras
        function updateExtrasDisplay() {
            const team1Extras = document.getElementById('team1-extras');
            const team2Extras = document.getElementById('team2-extras');
            
            team1Extras.innerHTML = team1.extras.length > 0 ? 
                team1.extras.map(p => `<div style="background-color: #4CAF50; color: white; padding: 5px; margin: 2px; border-radius: 3px;">${p}</div>`).join('') : 
                "Arrastra jugadores aquí";
                
            team2Extras.innerHTML = team2.extras.length > 0 ? 
                team2.extras.map(p => `<div style="background-color: #4CAF50; color: white; padding: 5px; margin: 2px; border-radius: 3px;">${p}</div>`).join('') : 
                "Arrastra jugadores aquí";
        }

        // Actualizar las posiciones en el campo
        function updateFieldPositions() {
            positions.forEach(pos => {
                const team1Pos = document.getElementById(`team1-${pos.id}`);
                const team2Pos = document.getElementById(`team2-${pos.id}`);
                
                if (team1.players[pos.id]) {
                    team1Pos.classList.add('filled');
                    team1Pos.querySelector('.player-name').textContent = team1.players[pos.id];
                } else {
                    team1Pos.classList.remove('filled');
                    team1Pos.querySelector('.player-name').textContent = '';
                }
                
                if (team2.players[pos.id]) {
                    team2Pos.classList.add('filled');
                    team2Pos.querySelector('.player-name').textContent = team2.players[pos.id];
                } else {
                    team2Pos.classList.remove('filled');
                    team2Pos.querySelector('.player-name').textContent = '';
                }
            });
            
            updateExtrasDisplay();
        }

        // Actualizar lista de jugadores disponibles
        function updateAvailablePlayers() {
            availablePlayersUl.innerHTML = '';
            if (availablePlayers.length === 0) {
                const li = document.createElement('li');
                li.textContent = "No hay jugadores disponibles";
                availablePlayersUl.appendChild(li);
            } else {
                availablePlayers.forEach(player => {
                    const li = document.createElement('li');
                    li.textContent = player;
                    li.draggable = true;
                    li.dataset.player = player;
                    li.addEventListener('dragstart', dragPlayer);
                    availablePlayersUl.appendChild(li);
                });
            }
        }

        // Funciones para drag and drop
        function dragPlayer(e) {
            draggedPlayer = e.target.dataset.player;
            e.target.classList.add('dragging');
            e.dataTransfer.setData('text/plain', e.target.dataset.player);
            e.dataTransfer.effectAllowed = 'move';
        }

        function allowDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.add('highlight');
        }

        function dragLeave(e) {
            e.currentTarget.classList.remove('highlight');
        }

        function dropPlayer(e, positionId, team) {
            e.preventDefault();
            e.currentTarget.classList.remove('highlight');
            
            const player = e.dataTransfer.getData('text/plain');
            
            // Verificar que sea el turno del equipo correcto (excepto para extras)
            if (positionId !== 'extra' && currentPickingTeam !== team) {
                alert(`No es el turno de ${team === 1 ? team1.name : team2.name}. Es el turno de ${currentPickingTeam === 1 ? team1.name : team2.name}.`);
                return;
            }
            
            // Asignar jugador
            assignPlayerToPosition(player, positionId, team);
        }

        // Asignar jugador a una posición
        function assignPlayerToPosition(player, positionId, team) {
            // Verificar que el jugador no esté ya en el equipo
            if (team === 1) {
                if (Object.values(team1.players).includes(player) || team1.extras.includes(player)) {
                    alert("Este jugador ya está en el equipo.");
                    return;
                }
            } else {
                if (Object.values(team2.players).includes(player) || team2.extras.includes(player)) {
                    alert("Este jugador ya está en el equipo.");
                    return;
                }
            }
            
            // Asignar jugador
            if (positionId !== 'extra') {
                if (team === 1) {
                    team1.players[positionId] = player;
                } else {
                    team2.players[positionId] = player;
                }
                
                // Eliminar jugador de la lista de disponibles
                const index = availablePlayers.indexOf(player);
                if (index !== -1) {
                    availablePlayers.splice(index, 1);
                }
                
                // Cambiar turno
                currentPickingTeam = currentPickingTeam === 1 ? 2 : 1;
            } else {
                if (team === 1) {
                    team1.extras.push(player);
                } else {
                    team2.extras.push(player);
                }
                
                // No cambia el turno para extras
            }
            
            // Actualizar UI
            updateFieldPositions();
            updateAvailablePlayers();
            updateTurnInfo();
        }

        // Mostrar sección para agregar jugadores
        function showAddPlayers() {
            addPlayersSection.classList.toggle('hidden');
        }

        // Agregar nuevo jugador
        function addNewPlayer() {
            const playerName = newPlayerNameInput.value.trim();
            if (playerName === "") {
                alert("Por favor ingresa un nombre válido.");
                return;
            }
            
            if (allPlayers.includes(playerName)) {
                alert("Este jugador ya existe.");
                return;
            }
            
            allPlayers.push(playerName);
            availablePlayers.push(playerName);
            
            newPlayerNameInput.value = "";
            updateAvailablePlayers();
            addPlayersSection.classList.add('hidden');
        }

        // Actualizar información del turno
        function updateTurnInfo() {
            const currentTeam = currentPickingTeam === 1 ? team1 : team2;
            currentTeamNameSpan.textContent = currentTeam.name;
            currentTeamNameSpan.style.color = currentPickingTeam === 1 ? '#007bff' : '#dc3545';
            currentPickInfo.textContent = `Es el turno de ${currentTeam.name} para elegir.`;
        }

        // Reiniciar el draft
        function resetDraft() {
            if (confirm('¿Estás seguro que quieres reiniciar el draft? Se perderán todos los jugadores elegidos.')) {
                setupScreen.classList.remove('hidden');
                draftScreen.classList.add('hidden');
            }
        }

        // Descargar PDF con las selecciones
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            let yOffset = 20;
            const lineHeight = 10;

            doc.setFontSize(20);
            doc.text("Resultados del Draft de Softball", 105, yOffset, null, null, "center");
            yOffset += 20;

            // Equipo 1
            doc.setFontSize(16);
            doc.text(`${team1.name}:`, 20, yOffset);
            yOffset += lineHeight;
            
            let hasPlayers1 = false;
            positions.forEach(pos => {
                if (team1.players[pos.id]) {
                    doc.setFontSize(12);
                    doc.text(`- ${pos.name}: ${team1.players[pos.id]}`, 25, yOffset);
                    yOffset += lineHeight;
                    hasPlayers1 = true;
                }
            });
            
            if (team1.extras.length > 0) {
                doc.setFontSize(12);
                doc.text(`- DH/Extras: ${team1.extras.join(", ")}`, 25, yOffset);
                yOffset += lineHeight;
                hasPlayers1 = true;
            }
            
            if (!hasPlayers1) {
                doc.setFontSize(12);
                doc.text("No hay jugadores seleccionados.", 25, yOffset);
                yOffset += lineHeight;
            }
            
            yOffset += 10;

            // Equipo 2
            doc.setFontSize(16);
            doc.text(`${team2.name}:`, 20, yOffset);
            yOffset += lineHeight;
            
            let hasPlayers2 = false;
            positions.forEach(pos => {
                if (team2.players[pos.id]) {
                    doc.setFontSize(12);
                    doc.text(`- ${pos.name}: ${team2.players[pos.id]}`, 25, yOffset);
                    yOffset += lineHeight;
                    hasPlayers2 = true;
                }
            });
            
            if (team2.extras.length > 0) {
                doc.setFontSize(12);
                doc.text(`- DH/Extras: ${team2.extras.join(", ")}`, 25, yOffset);
                yOffset += lineHeight;
                hasPlayers2 = true;
            }
            
            if (!hasPlayers2) {
                doc.setFontSize(12);
                doc.text("No hay jugadores seleccionados.", 25, yOffset);
                yOffset += lineHeight;
            }

            doc.save(`Draft_Softball_${team1.name}_vs_${team2.name}.pdf`);
        }

        // Event listeners
        startDraftBtn.addEventListener('click', initializeDraft);

        // Permitir iniciar con Enter en los campos de texto
        team1NameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') initializeDraft();
        });
        team2NameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') initializeDraft();
        });
        playerListInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') initializeDraft();
        });
        newPlayerNameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addNewPlayer();
        });
    </script>
</body>
</html>
