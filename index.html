<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draft de Softball</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .draft-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 1200px;
            margin-top: 20px;
            gap: 20px;
        }
        .team-panel {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            width: 45%;
        }
        .player-pool {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            width: 45%;
        }
        h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #e9ecef;
        }
        tr:nth-child(even) {
            background-color: #1722f9;
        }
        .player-list {
            list-style: none;
            padding: 0;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
        }
        .player-list li {
            background-color: #e9ecef;
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s ease;
        }
        .player-list li:hover {
            background-color: #eee70d;
        }
        .player-actions {
            display: flex;
            gap: 5px;
        }
        .btn {
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            border: none;
            color: 0d14ee;
            font-size: 14px;
            transition: background-color 0.2s ease;
        }
        .btn-select {
            background-color: #28a745;
        }
        .btn-select:hover {
            background-color: #218838;
        }
        .btn-replace {
            background-color: #ffc107;
            color: #212529;
        }
        .btn-replace:hover {
            background-color: #e0a800;
        }
        .btn-remove {
            background-color: #dc3545;
        }
        .btn-remove:hover {
            background-color: #c82333;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        .controls button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s ease;
        }
        .controls button:hover {
            background-color: #0056b3;
        }
        .controls button.download-btn {
            background-color: #6c757d;
        }
        .controls button.download-btn:hover {
            background-color: #5a6268;
        }
        .current-pick-info {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1em;
            font-weight: bold;
            color: #007bff;
        }
        .setup-screen {
            width: 80%;
            max-width: 600px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .setup-screen h1 {
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .setup-form {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input, .form-group textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        .start-draft-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            margin-top: 20px;
            transition: background-color 0.2s ease;
        }
        .start-draft-btn:hover {
            background-color: #218838;
        }
        .hidden {
            display: none;
        }
        .team1 {
            background-color: #e7f3ff;
        }
        .team2 {
            background-color: #ffebeb;
        }
        .add-players-btn {
            background-color: #17a2b8;
            margin-bottom: 15px;
        }
        .add-players-btn:hover {
            background-color: #138496;
        }
        .player-input-container {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        .player-input-container input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .player-input-container button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        .position-filled {
            background-color: #d4edda;
        }
        .position-actions {
            display: flex;
            gap: 5px;
        }
        .manager-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .manager-name {
            font-weight: bold;
        }
        .manager-actions {
            display: flex;
            gap: 5px;
        }

        /* Estilos para controlar la visibilidad de los botones de selección de jugador */
        .player-list li .btn-select-player {
            display: none; /* Oculto por defecto */
        }
        .player-list.show-buttons li .btn-select-player {
            display: inline-block; /* Visible cuando la clase show-buttons está activa */
        }
    </style>
</head>
<body>
    <!-- Pantalla de configuración inicial -->
    <div id="setupScreen" class="setup-screen">
        <h1>Configuración del Draft</h1>
        <div class="setup-form">
            <div class="form-group">
                <label for="team1Name">Nombre del Equipo 1:</label>
                <input type="text" id="team1Name" placeholder="Ej: Los Tigres" required>
            </div>
            <div class="form-group">
                <label for="team2Name">Nombre del Equipo 2:</label>
                <input type="text" id="team2Name" placeholder="Ej: Las Águilas" required>
            </div>
            <div class="form-group">
                <label for="playerList">Lista de Jugadores (uno por línea o separados por comas):</label>
                <textarea id="playerList" placeholder="Ej: Juan Pérez&#10;Carlos Gómez&#10;María Rodríguez" required></textarea>
            </div>
        </div>
        <button id="startDraftBtn" class="start-draft-btn">Comenzar Draft</button>
    </div>

    <!-- Pantalla principal del draft (inicialmente oculta) -->
    <div id="draftScreen" class="hidden">
        <h1>Simulador de Draft de Softball</h1>
        <p class="current-pick-info" id="currentPickInfo">Es el turno del <span id="currentTeamName"></span> para elegir.</p>

        <div class="draft-container">
            <!-- Equipo 1 -->
            <div class="team-panel team1">
                <h2 id="team1Title">Equipo 1</h2>
                
                <div class="manager-section">
                    <div>
                        <span>Manager: </span>
                        <span class="manager-name" id="team1-manager">(Sin asignar)</span>
                    </div>
                    <div class="manager-actions">
                        <button class="btn btn-select" onclick="startSelectManager(1)">Asignar</button>
                        <button class="btn btn-remove" onclick="removeManager(1)" id="team1-remove-manager" style="display: none;">Eliminar</button>
                    </div>
                </div>
                
                <table id="team1Table">
                    <thead>
                        <tr>
                            <th>Posición</th>
                            <th>Jugador</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Pitcher</td>
                            <td id="team1-pitcher"></td>
                            <td class="position-actions" id="team1-pitcher-actions"></td>
                        </tr>
                        <tr>
                            <td>Catcher</td>
                            <td id="team1-catcher"></td>
                            <td class="position-actions" id="team1-catcher-actions"></td>
                        </tr>
                        <tr>
                            <td>1ra Base</td>
                            <td id="team1-firstBase"></td>
                            <td class="position-actions" id="team1-firstBase-actions"></td>
                        </tr>
                        <tr>
                            <td>2da Base</td>
                            <td id="team1-secondBase"></td>
                            <td class="position-actions" id="team1-secondBase-actions"></td>
                        </tr>
                        <tr>
                            <td>3ra Base</td>
                            <td id="team1-thirdBase"></td>
                            <td class="position-actions" id="team1-thirdBase-actions"></td>
                        </tr>
                        <tr>
                            <td>Shortstop</td>
                            <td id="team1-shortstop"></td>
                            <td class="position-actions" id="team1-shortstop-actions"></td>
                        </tr>
                        <tr>
                            <td>J. Izquierdo</td>
                            <td id="team1-leftField"></td>
                            <td class="position-actions" id="team1-leftField-actions"></td>
                        </tr>
                        <tr>
                            <td>J. Central</td>
                            <td id="team1-centerField"></td>
                            <td class="position-actions" id="team1-centerField-actions"></td>
                        </tr>
                        <tr>
                            <td>J. Derecho</td>
                            <td id="team1-rightField"></td>
                            <td class="position-actions" id="team1-rightField-actions"></td>
                        </tr>
                        <tr>
                            <td>DH/Extras</td>
                            <td id="team1-extra"></td>
                            <td class="position-actions" id="team1-extra-actions"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Jugadores disponibles en el centro -->
            <div class="player-pool">
                <h2 id="selectionTitle">Jugadores Disponibles</h2>
                <div id="selectionContainer">
                    <button id="addPlayersBtn" class="controls button add-players-btn" onclick="showAddPlayers()">Agregar más jugadores</button>
                    <div id="addPlayersSection" class="hidden">
                        <div class="player-input-container">
                            <input type="text" id="newPlayerName" placeholder="Nombre del jugador">
                            <button onclick="addNewPlayer()">Agregar</button>
                        </div>
                    </div>
                    <ul id="availablePlayers" class="player-list">
                        <!-- Jugadores se cargarán aquí -->
                    </ul>
                </div>
            </div>

            <!-- Equipo 2 -->
            <div class="team-panel team2">
                <h2 id="team2Title">Equipo 2</h2>
                
                <div class="manager-section">
                    <div>
                        <span>Manager: </span>
                        <span class="manager-name" id="team2-manager">(Sin asignar)</span>
                    </div>
                    <div class="manager-actions">
                        <button class="btn btn-select" onclick="startSelectManager(2)">Asignar</button>
                        <button class="btn btn-remove" onclick="removeManager(2)" id="team2-remove-manager" style="display: none;">Eliminar</button>
                    </div>
                </div>
                
                <table id="team2Table">
                    <thead>
                        <tr>
                            <th>Posición</th>
                            <th>Jugador</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Pitcher</td>
                            <td id="team2-pitcher"></td>
                            <td class="position-actions" id="team2-pitcher-actions"></td>
                        </tr>
                        <tr>
                            <td>Catcher</td>
                            <td id="team2-catcher"></td>
                            <td class="position-actions" id="team2-catcher-actions"></td>
                        </tr>
                        <tr>
                            <td>1ra Base</td>
                            <td id="team2-firstBase"></td>
                            <td class="position-actions" id="team2-firstBase-actions"></td>
                        </tr>
                        <tr>
                            <td>2da Base</td>
                            <td id="team2-secondBase"></td>
                            <td class="position-actions" id="team2-secondBase-actions"></td>
                        </tr>
                        <tr>
                            <td>3ra Base</td>
                            <td id="team2-thirdBase"></td>
                            <td class="position-actions" id="team2-thirdBase-actions"></td>
                        </tr>
                        <tr>
                            <td>Shortstop</td>
                            <td id="team2-shortstop"></td>
                            <td class="position-actions" id="team2-shortstop-actions"></td>
                        </tr>
                        <tr>
                            <td>J. Izquierdo</td>
                            <td id="team2-leftField"></td>
                            <td class="position-actions" id="team2-leftField-actions"></td>
                        </tr>
                        <tr>
                            <td>J. Central</td>
                            <td id="team2-centerField"></td>
                            <td class="position-actions" id="team2-centerField-actions"></td>
                        </tr>
                        <tr>
                            <td>J. Derecho</td>
                            <td id="team2-rightField"></td>
                            <td class="position-actions" id="team2-rightField-actions"></td>
                        </tr>
                        <tr>
                            <td>DH/Extras</td>
                            <td id="team2-extra"></td>
                            <td class="position-actions" id="team2-extra-actions"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="controls">
            <button onclick="resetDraft()">Reiniciar Draft</button>
            <button class="download-btn" onclick="downloadPDF()">Descargar Selecciones (PDF)</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Variables globales
        let allPlayers = []; // Todos los jugadores ingresados inicialmente
        let availablePlayers = []; // Jugadores actualmente disponibles para ser seleccionados
        let team1 = {
            name: "Equipo 1",
            manager: null,
            players: {},
            extras: []
        };
        let team2 = {
            name: "Equipo 2",
            manager: null,
            players: {},
            extras: []
        };
        let currentPickingTeam = 1; // 1 para Equipo 1, 2 para Equipo 2
        let currentPosition = null; // La posición actual que se está llenando (e.g., 'pitcher', 'catcher', or 'extra')
        let currentTeamForSelection = null; // El equipo para el que se está realizando una selección (jugador o manager)
        let selectingManager = false; // Bandera para saber si estamos seleccionando un manager

        // Posiciones de softball
        const positions = [
            { id: "pitcher", name: "Pitcher" },
            { id: "catcher", name: "Catcher" },
            { id: "firstBase", name: "1ra Base" },
            { id: "secondBase", name: "2da Base" },
            { id: "thirdBase", name: "3ra Base" },
            { id: "shortstop", name: "Shortstop" },
            { id: "leftField", name: "J. Izquierdo" },
            { id: "centerField", name: "J. Central" },
            { id: "rightField", name: "J. Derecho" },
            { id: "extra", name: "DH/Extra" }
        ];

        // Elementos del DOM
        const setupScreen = document.getElementById('setupScreen');
        const draftScreen = document.getElementById('draftScreen');
        const team1NameInput = document.getElementById('team1Name');
        const team2NameInput = document.getElementById('team2Name');
        const playerListInput = document.getElementById('playerList');
        const startDraftBtn = document.getElementById('startDraftBtn');
        const currentPickInfo = document.getElementById('currentPickInfo');
        const currentTeamNameSpan = document.getElementById('currentTeamName');
        const team1Title = document.getElementById('team1Title');
        const team2Title = document.getElementById('team2Title');
        const availablePlayersUl = document.getElementById('availablePlayers');
        const addPlayersBtn = document.getElementById('addPlayersBtn'); // Ya está en el HTML, no se necesita recrear
        const addPlayersSection = document.getElementById('addPlayersSection'); // Ya está en el HTML, no se necesita recrear
        const newPlayerNameInput = document.getElementById('newPlayerName');
        const selectionTitle = document.getElementById('selectionTitle');
        // const selectionContainer = document.getElementById('selectionContainer'); // No se necesita limpiar todo el contenedor

        // Event listener para iniciar el draft
        startDraftBtn.addEventListener('click', initializeDraft);

        /**
         * Inicializa el proceso del draft, obteniendo la configuración inicial
         * y mostrando la pantalla del draft.
         */
        function initializeDraft() {
            // Obtener nombres de equipos
            team1.name = team1NameInput.value || "Equipo 1";
            team2.name = team2NameInput.value || "Equipo 2";
            
            // Actualizar títulos en la pantalla del draft
            team1Title.textContent = team1.name;
            team2Title.textContent = team2.name;
            
            // Obtener lista de jugadores del textarea
            const playersText = playerListInput.value;
            allPlayers = playersText.split(/[\n,]/)
                .map(player => player.trim())
                .filter(player => player !== "");
            
            // Si no hay jugadores ingresados, alertar al usuario y no iniciar el draft
            if (allPlayers.length === 0) {
                alert("Por favor, ingresa al menos un jugador para comenzar el draft.");
                return;
            }
            
            // Todos los jugadores ingresados están disponibles al inicio (incluyendo los potenciales managers)
            availablePlayers = [...allPlayers];
            
            // Reiniciar jugadores y managers de los equipos
            positions.forEach(pos => {
                if (pos.id !== 'extra') {
                    team1.players[pos.id] = null;
                    team2.players[pos.id] = null;
                }
            });
            team1.extras = [];
            team2.extras = [];
            team1.manager = null;
            team2.manager = null;
            
            // Actualizar tablas de equipos y display de managers
            updateTeamTables();
            updateManagersDisplay();
            
            // Actualizar la lista de jugadores disponibles (sin botones de seleccionar al inicio)
            updateAvailablePlayers();
            
            // Actualizar información del turno
            updateTurnInfo();
            
            // Mostrar pantalla del draft y ocultar la de configuración
            setupScreen.classList.add('hidden');
            draftScreen.classList.remove('hidden');

            // Asegurarse de que los botones de selección de jugador estén ocultos al inicio del draft
            availablePlayersUl.classList.remove('show-buttons');
        }

        /**
         * Actualiza el contenido de las tablas de ambos equipos en la UI.
         */
        function updateTeamTables() {
            positions.forEach(pos => {
                if (pos.id !== 'extra') {
                    updatePositionCell(1, pos.id);
                    updatePositionCell(2, pos.id);
                } else {
                    updateExtrasCell(1);
                    updateExtrasCell(2);
                }
            });
        }

        /**
         * Actualiza la visualización de los managers en la UI.
         */
        function updateManagersDisplay() {
            const team1Manager = document.getElementById('team1-manager');
            const team2Manager = document.getElementById('team2-manager');
            const team1RemoveBtn = document.getElementById('team1-remove-manager');
            const team2RemoveBtn = document.getElementById('team2-remove-manager');
            
            if (team1.manager) {
                team1Manager.textContent = team1.manager;
                team1RemoveBtn.style.display = 'inline-block';
            } else {
                team1Manager.textContent = "(Sin asignar)";
                team1RemoveBtn.style.display = 'none';
            }
            
            if (team2.manager) {
                team2Manager.textContent = team2.manager;
                team2RemoveBtn.style.display = 'inline-block';
            } else {
                team2Manager.textContent = "(Sin asignar)";
                team2RemoveBtn.style.display = 'none';
            }
        }

        /**
         * Actualiza el contenido de una celda de posición específica en la tabla de un equipo.
         * @param {number} team - El número del equipo (1 o 2).
         * @param {string} positionId - El ID de la posición (e.g., 'pitcher', 'catcher').
         */
        function updatePositionCell(team, positionId) {
            const cell = document.getElementById(`team${team}-${positionId}`);
            const actionsCell = document.getElementById(`team${team}-${positionId}-actions`);
            
            const teamObj = team === 1 ? team1 : team2;
            const player = teamObj.players[positionId];
            
            if (player) {
                cell.textContent = player;
                cell.classList.add('position-filled');
                
                // Botones para posiciones ocupadas: Reemplazar y Eliminar
                actionsCell.innerHTML = `
                    <button class="btn btn-replace" onclick="startReplacePlayer('${positionId}', ${team})">Reemplazar</button>
                    <button class="btn btn-remove" onclick="removePlayer('${positionId}', ${team})">Eliminar</button>
                `;
            } else {
                cell.textContent = "(Vacante)";
                cell.classList.remove('position-filled');
                
                // Botón para posiciones vacantes: Seleccionar
                actionsCell.innerHTML = `
                    <button class="btn btn-select" onclick="startSelectPlayer('${positionId}', ${team})">Seleccionar</button>
                `;
            }
        }

        /**
         * Actualiza el contenido de la celda de jugadores extras en la tabla de un equipo.
         * @param {number} team - El número del equipo (1 o 2).
         */
        function updateExtrasCell(team) {
            const cell = document.getElementById(`team${team}-extra`);
            const actionsCell = document.getElementById(`team${team}-extra-actions`);
            const teamObj = team === 1 ? team1 : team2;
            
            if (teamObj.extras.length > 0) {
                cell.textContent = teamObj.extras.join(", ");
                cell.classList.add('position-filled');
                
                // Botones para extras: Agregar y Limpiar
                actionsCell.innerHTML = `
                    <button class="btn btn-select" onclick="startAddExtra(${team})">Agregar</button>
                    <button class="btn btn-remove" onclick="clearExtras(${team})">Limpiar</button>
                `;
            } else {
                cell.textContent = "(Vacante)";
                cell.classList.remove('position-filled');
                
                // Botón para extras vacíos: Agregar
                actionsCell.innerHTML = `
                    <button class="btn btn-select" onclick="startAddExtra(${team})">Agregar</button>
                `;
            }
        }

        /**
         * Inicia el proceso de selección de un manager para un equipo.
         * @param {number} team - El número del equipo (1 o 2) que seleccionará el manager.
         */
        function startSelectManager(team) {
            selectingManager = true; // Establecer la bandera para indicar que se está seleccionando un manager
            currentTeamForSelection = team; // Guardar el equipo para el cual se selecciona el manager
            currentPosition = null; // No hay posición específica para manager
            selectionTitle.textContent = "Seleccionar Manager"; // Actualizar título
            availablePlayersUl.classList.add('show-buttons'); // Mostrar botones de selección
            updateAvailablePlayers(); // Renderizar la lista de jugadores con botones
        }

        /**
         * Asigna un manager a un equipo y lo remueve de la lista de disponibles (jugadores).
         * @param {string} managerName - El nombre del manager a asignar.
         */
        function assignManager(managerName) {
            const team = currentTeamForSelection;
            const teamObj = team === 1 ? team1 : team2;
            
            // Si el equipo ya tenía un manager, lo devolvemos a la lista de jugadores disponibles
            if (teamObj.manager) {
                availablePlayers.push(teamObj.manager);
            }
            
            // Asignar el nuevo manager
            teamObj.manager = managerName;
            
            // Remover el manager de la lista de jugadores disponibles
            const index = availablePlayers.indexOf(managerName);
            if (index !== -1) {
                availablePlayers.splice(index, 1);
            }
            
            // Resetear las banderas de selección
            selectingManager = false;
            currentTeamForSelection = null;
            
            // Actualizar la UI
            updateManagersDisplay();
            updateAvailablePlayers(); // Refrescar la lista de jugadores disponibles (ocultará los botones)
            selectionTitle.textContent = "Jugadores Disponibles"; // Restaurar el título
            availablePlayersUl.classList.remove('show-buttons'); // Ocultar botones de selección
            updateTurnInfo(); // Actualizar el turno para el siguiente equipo/acción
        }

        /**
         * Elimina el manager de un equipo y lo devuelve a la lista de jugadores disponibles.
         * @param {number} team - El número del equipo (1 o 2) al que se le eliminará el manager.
         */
        function removeManager(team) {
            const teamObj = team === 1 ? team1 : team2;
            
            if (teamObj.manager) {
                // Devolver el manager a la lista de jugadores disponibles
                availablePlayers.push(teamObj.manager);
                teamObj.manager = null; // Eliminar el manager del equipo
                
                // Actualizar la UI
                updateManagersDisplay();
                updateAvailablePlayers(); // Refrescar la lista de jugadores disponibles
            }
        }

        /**
         * Inicia el proceso de selección de un jugador para una posición específica.
         * @param {string} positionId - El ID de la posición a llenar.
         * @param {number} team - El número del equipo (1 o 2) que seleccionará el jugador.
         */
        function startSelectPlayer(positionId, team) {
            // Verificar si es el turno del equipo correcto para seleccionar un jugador
            if (currentPickingTeam !== team) {
                alert(`No es el turno de ${team === 1 ? team1.name : team2.name}. Es el turno de ${currentPickingTeam === 1 ? team1.name : team2.name}.`);
                return;
            }
            
            selectingManager = false; // Asegurarse de que no estamos en modo selección de manager
            currentPosition = positionId; // Guardar la posición a llenar
            currentTeamForSelection = team; // Guardar el equipo para el cual se selecciona el jugador
            
            const positionName = positions.find(p => p.id === currentPosition)?.name || "Jugador";
            selectionTitle.textContent = `Seleccionar ${positionName} para ${currentTeamForSelection === 1 ? team1.name : team2.name}`;
            availablePlayersUl.classList.add('show-buttons'); // Mostrar botones de selección
            updateAvailablePlayers(); // Renderizar la lista de jugadores con botones
        }

        /**
         * Inicia el proceso de reemplazo de un jugador en una posición existente.
         * El jugador actual es devuelto a la lista de disponibles.
         * @param {string} positionId - El ID de la posición del jugador a reemplazar.
         * @param {number} team - El número del equipo (1 o 2) cuyo jugador será reemplazado.
         */
        function startReplacePlayer(positionId, team) {
            const teamObj = team === 1 ? team1 : team2;
            const playerToReplace = teamObj.players[positionId];

            // Devolver el jugador reemplazado a la lista de disponibles
            if (playerToReplace) {
                availablePlayers.push(playerToReplace);
            }

            // La posición se considera vacante para la nueva selección
            teamObj.players[positionId] = null; 
            
            selectingManager = false;
            currentPosition = positionId;
            currentTeamForSelection = team;
            updateTeamTables(); // Actualizar para mostrar "Vacante" y el botón "Seleccionar"
            
            const positionName = positions.find(p => p.id === currentPosition)?.name || "Jugador";
            selectionTitle.textContent = `Reemplazar ${positionName} para ${currentTeamForSelection === 1 ? team1.name : team2.name}`;
            availablePlayersUl.classList.add('show-buttons'); // Mostrar botones de selección
            updateAvailablePlayers(); // Mostrar la lista para elegir un reemplazo
        }

        /**
         * Inicia el proceso de agregar un jugador a la sección de extras.
         * @param {number} team - El número del equipo (1 o 2) al que se le agregará un extra.
         */
        function startAddExtra(team) {
            selectingManager = false;
            currentPosition = 'extra'; // Indicar que se está agregando un extra
            currentTeamForSelection = team;
            
            selectionTitle.textContent = `Seleccionar DH/Extra para ${currentTeamForSelection === 1 ? team1.name : team2.name}`;
            availablePlayersUl.classList.add('show-buttons'); // Mostrar botones de selección
            updateAvailablePlayers();
        }

        /**
         * Asigna un jugador a la posición o a la lista de extras del equipo actual.
         * @param {string} playerName - El nombre del jugador a asignar.
         */
        function selectPlayer(playerName) {
            const teamObj = currentTeamForSelection === 1 ? team1 : team2;
            
            if (currentPosition === 'extra') {
                teamObj.extras.push(playerName); // Agregar a la lista de extras
            } else {
                teamObj.players[currentPosition] = playerName; // Asignar a la posición específica
            }
            
            // Remover el jugador de la lista de disponibles
            const index = availablePlayers.indexOf(playerName);
            if (index !== -1) {
                availablePlayers.splice(index, 1);
            }
            
            // Actualizar la UI
            updateTeamTables();
            updateAvailablePlayers(); // Refrescar la lista de jugadores disponibles (ocultará los botones)
            currentPosition = null; // Reiniciar la posición actual
            currentTeamForSelection = null; // Reiniciar el equipo de selección
            
            // Cambiar el turno al siguiente equipo
            currentPickingTeam = currentPickingTeam === 1 ? 2 : 1;
            updateTurnInfo(); // Actualizar la información del turno
            selectionTitle.textContent = "Jugadores Disponibles"; // Restaurar el título
            availablePlayersUl.classList.remove('show-buttons'); // Ocultar botones de selección
        }

        /**
         * Elimina un jugador de una posición específica del equipo y lo devuelve a la lista de disponibles.
         * @param {string} positionId - El ID de la posición del jugador a eliminar.
         * @param {number} team - El número del equipo (1 o 2) cuyo jugador será eliminado.
         */
        function removePlayer(positionId, team) {
            const teamObj = team === 1 ? team1 : team2;
            const playerToRemove = teamObj.players[positionId];
            
            if (playerToRemove) {
                availablePlayers.push(playerToRemove); // Devolver el jugador a la lista de disponibles
                teamObj.players[positionId] = null; // Vaciar la posición
                
                // Actualizar la UI
                updatePositionCell(team, positionId);
                updateAvailablePlayers();
            }
        }

        /**
         * Limpia la lista de jugadores extras de un equipo y los devuelve a la lista de disponibles.
         * @param {number} team - El número del equipo (1 o 2) al que se le limpiarán los extras.
         */
        function clearExtras(team) {
            const teamObj = team === 1 ? team1 : team2;
            
            if (teamObj.extras.length > 0) {
                teamObj.extras.forEach(extra => availablePlayers.push(extra)); // Devolver extras a disponibles
                teamObj.extras = []; // Limpiar la lista de extras
                
                // Actualizar la UI
                updateExtrasCell(team);
                updateAvailablePlayers();
            }
        }

        /**
         * Muestra u oculta la sección para agregar nuevos jugadores.
         */
        function showAddPlayers() {
            addPlayersSection.classList.toggle('hidden'); // Alternar la visibilidad
            newPlayerNameInput.value = ''; // Limpiar el input
            newPlayerNameInput.focus(); // Enfocar el input
        }

        /**
         * Agrega un nuevo jugador a la lista de jugadores disponibles.
         */
        function addNewPlayer() {
            const playerName = newPlayerNameInput.value.trim();
            if (playerName && !availablePlayers.includes(playerName) && !allPlayers.includes(playerName)) {
                availablePlayers.push(playerName); // Agregar a disponibles
                allPlayers.push(playerName); // También agregar a la lista global de todos los jugadores
                newPlayerNameInput.value = ''; // Limpiar el input
                updateAvailablePlayers(); // Refrescar la lista en la UI
            } else if (playerName && (availablePlayers.includes(playerName) || allPlayers.includes(playerName))) {
                alert(`"${playerName}" ya está en la lista de jugadores.`);
            }
            newPlayerNameInput.focus(); // Mantener el foco
        }


        /**
         * Actualiza la lista de jugadores disponibles en la interfaz.
         * La visibilidad del botón "Seleccionar" se controla mediante la clase 'show-buttons' en availablePlayersUl.
         */
        function updateAvailablePlayers() {
            availablePlayersUl.innerHTML = ''; // Limpiar la lista actual
            
            // Ordenar los jugadores alfabéticamente
            availablePlayers.sort((a, b) => a.localeCompare(b));

            if (availablePlayers.length === 0) {
                const message = document.createElement('p');
                message.textContent = "No hay jugadores disponibles.";
                availablePlayersUl.appendChild(message);
            } else {
                availablePlayers.forEach(player => {
                    const li = document.createElement('li');
                    li.textContent = player;
                    
                    const selectBtn = document.createElement('button');
                    // Usar una clase específica para los botones de selección de jugador
                    selectBtn.className = 'btn btn-select-player'; 
                    selectBtn.textContent = selectingManager ? 'Asignar' : 'Seleccionar'; // Texto dinámico
                    selectBtn.onclick = () => {
                        if (selectingManager) {
                            assignManager(player);
                        } else {
                            selectPlayer(player);
                        }
                    };
                    
                    li.appendChild(selectBtn);
                    availablePlayersUl.appendChild(li);
                });
            }
        }

        /**
         * Actualiza la información del turno en la parte superior de la pantalla del draft.
         */
        function updateTurnInfo() {
            let teamName = "";
            if (currentPickingTeam === 1) {
                teamName = team1.name;
            } else {
                teamName = team2.name;
            }
            currentTeamNameSpan.textContent = teamName;
        }

        /**
         * Reinicia el draft a su estado inicial, volviendo a la pantalla de configuración.
         */
        function resetDraft() {
            if (confirm("¿Estás seguro de que quieres reiniciar el draft? Se perderán todas las selecciones.")) {
                // Restablecer todas las variables globales
                allPlayers = [];
                availablePlayers = [];
                team1 = { name: "Equipo 1", manager: null, players: {}, extras: [] };
                team2 = { name: "Equipo 2", manager: null, players: {}, extras: [] };
                currentPickingTeam = 1;
                currentPosition = null;
                currentTeamForSelection = null;
                selectingManager = false;

                // Limpiar campos de entrada
                team1NameInput.value = "";
                team2NameInput.value = "";
                playerListInput.value = "";

                // Ocultar pantalla del draft y mostrar la de configuración
                draftScreen.classList.add('hidden');
                setupScreen.classList.remove('hidden');

                // Restablecer títulos de la sección de selección
                selectionTitle.textContent = "Jugadores Disponibles";
                // Asegurarse de que los botones de selección de jugador estén ocultos
                availablePlayersUl.classList.remove('show-buttons');
            }
        }

        /**
         * Genera y descarga un PDF con las selecciones de ambos equipos.
         */
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            let yPos = 10;
            const margin = 10;
            const lineHeight = 7;
            const col1Width = 40;
            const col2Width = 80;

            doc.setFontSize(18);
            doc.text("Resultados del Draft de Softball", margin, yPos);
            yPos += 15;

            // Función para dibujar la tabla de un equipo
            function drawTeamTable(teamObj, teamNumber) {
                doc.setFontSize(14);
                doc.text(`${teamObj.name}`, margin, yPos);
                yPos += lineHeight;

                doc.setFontSize(12);
                doc.text(`Manager: ${teamObj.manager || '(Sin asignar)'}`, margin, yPos);
                yPos += lineHeight * 2; // Espacio después del manager

                // Encabezados de la tabla
                doc.setFontSize(10);
                doc.text("Posición", margin, yPos);
                doc.text("Jugador", margin + col1Width, yPos);
                yPos += lineHeight;

                // Línea divisoria
                doc.line(margin, yPos - 2, margin + col1Width + col2Width, yPos - 2);

                // Filas de la tabla
                doc.setFontSize(10);
                positions.forEach(pos => {
                    const player = teamObj.players[pos.id];
                    if (pos.id !== 'extra') {
                        doc.text(pos.name, margin, yPos);
                        doc.text(player || '(Vacante)', margin + col1Width, yPos);
                    } else {
                        doc.text(pos.name, margin, yPos);
                        doc.text(teamObj.extras.length > 0 ? teamObj.extras.join(", ") : '(Vacante)', margin + col1Width, yPos);
                    }
                    yPos += lineHeight;
                });
                yPos += 10; // Espacio entre equipos
            }

            drawTeamTable(team1, 1);
            drawTeamTable(team2, 2);

            doc.save("draft_softball_resultados.pdf");
        }
    </script>
</body>
</html>
