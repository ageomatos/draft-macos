<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draft de Macos</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #f4f4f4;
            color: #333;
        }
        .app-container {
            max-width: 100%;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            font-size: 1.5rem;
            margin: 10px 0;
        }
        .current-pick-info {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            color: #007bff;
            padding: 8px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .team-panel {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 15px;
        }
        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .team-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        .manager-info {
            font-size: 0.9rem;
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .manager-name {
            font-weight: bold;
        }
        .manager-actions {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }
        .position-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .position-info {
            flex: 1;
            min-width: 0;
        }
        .position-name {
            font-weight: bold;
            font-size: 0.9rem;
        }
        .position-player {
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .position-actions {
            display: flex;
            gap: 5px;
        }
        .btn {
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            border: none;
            color: white;
            font-size: 0.8rem;
            transition: background-color 0.2s ease;
        }
        .btn-select {
            background-color: #28a745;
        }
        .btn-select:hover {
            background-color: #218838;
        }
        .btn-replace {
            background-color: #ffc107;
            color: #212529;
        }
        .btn-replace:hover {
            background-color: #e0a800;
        }
        .btn-remove {
            background-color: #dc3545;
        }
        .btn-remove:hover {
            background-color: #c82333;
        }
        .btn-manager {
            background-color: #6f42c1;
        }
        .btn-manager:hover {
            background-color: #5a3d8e;
        }
        .player-pool {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 15px;
            margin-bottom: 15px;
        }
        .player-list {
            list-style: none;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px;
        }
        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 5px;
            background-color: #e9ecef;
            border-radius: 4px;
        }
        .player-name {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .player-actions {
            display: flex;
            gap: 5px;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .controls button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s ease;
        }
        .controls button:hover {
            background-color: #0056b3;
        }
        .controls button.download-btn {
            background-color: #6c757d;
        }
        .controls button.download-btn:hover {
            background-color: #5a6268;
        }
        .setup-screen {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 15px;
        }
        .setup-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9rem;
        }
        .form-group input, .form-group textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            width: 100%;
        }
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        .start-draft-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin-top: 10px;
            transition: background-color 0.2s ease;
            width: 100%;
        }
        .start-draft-btn:hover {
            background-color: #218838;
        }
        .hidden {
            display: none;
        }
        .position-filled {
            background-color: #d4edda;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 15px;
        }
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .modal-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0;
        }
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }
        @media (min-width: 768px) {
            .draft-container {
                display: flex;
                gap: 15px;
            }
            .team-column {
                flex: 1;
            }
            .player-pool {
                margin-bottom: 0;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Pantalla de configuración inicial -->
        <div id="setupScreen" class="setup-screen">
            <h1>Configuración del Draft</h1>
            <div class="setup-form">
                <div class="form-group">
                    <label for="team1Name">Nombre del Equipo 1:</label>
                    <input type="text" id="team1Name" placeholder="Ej: Los Tigres" required>
                </div>
                <div class="form-group">
                    <label for="team2Name">Nombre del Equipo 2:</label>
                    <input type="text" id="team2Name" placeholder="Ej: Las Águilas" required>
                </div>
                <div class="form-group">
                    <label for="playerList">Lista de Jugadores (uno por línea o separados por comas):</label>
                    <textarea id="playerList" placeholder="Ej: Juan Pérez&#10;Carlos Gómez&#10;María Rodríguez&#10;Luis Hernández&#10;Ana Torres&#10;Pedro Díaz&#10;Laura Soto&#10;Miguel Reyes&#10;Sofía Vargas&#10;Roberto Cruz&#10;Elena Ramos&#10;Andrés Castro&#10;Gabriela Gil&#10;Fernando Vega&#10;Isabel Núñez&#10;Diego Molina&#10;Valeria Pineda&#10;José Ortiz&#10;Camila Blanco&#10;Ricardo Marín" required></textarea>
                </div>
                <button id="startDraftBtn" class="start-draft-btn">Comenzar Draft</button>
            </div>
        </div>

        <!-- Pantalla principal del draft (inicialmente oculta) -->
        <div id="draftScreen" class="hidden">
            <h1>Simulador de Draft de Softball</h1>
            <p class="current-pick-info" id="currentPickInfo">Es el turno del <span id="currentTeamName"></span> para elegir.</p>

            <div class="draft-container">
                <!-- Equipo 1 -->
                <div class="team-column">
                    <div class="team-panel team1">
                        <div class="team-header">
                            <div class="team-title" id="team1Title">Equipo 1</div>
                        </div>
                        
                        <div class="manager-info">
                            <div>Manager: <span class="manager-name" id="team1-manager">(Sin asignar)</span></div>
                            <div class="manager-actions">
                                <button class="btn btn-manager" onclick="startSelectManager(1)">Asignar Manager</button>
                                <button class="btn btn-remove" onclick="removeManager(1)" id="team1-remove-manager" style="display: none;">Eliminar</button>
                            </div>
                        </div>
                        
                        <div id="team1-positions">
                            <!-- Posiciones se generarán dinámicamente -->
                        </div>
                    </div>
                </div>

                <!-- Equipo 2 -->
                <div class="team-column">
                    <div class="team-panel team2">
                        <div class="team-header">
                            <div class="team-title" id="team2Title">Equipo 2</div>
                        </div>
                        
                        <div class="manager-info">
                            <div>Manager: <span class="manager-name" id="team2-manager">(Sin asignar)</span></div>
                            <div class="manager-actions">
                                <button class="btn btn-manager" onclick="startSelectManager(2)">Asignar Manager</button>
                                <button class="btn btn-remove" onclick="removeManager(2)" id="team2-remove-manager" style="display: none;">Eliminar</button>
                            </div>
                        </div>
                        
                        <div id="team2-positions">
                            <!-- Posiciones se generarán dinámicamente -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Jugadores disponibles -->
            <div class="player-pool">
                <h2 id="selectionTitle">Jugadores Disponibles</h2>
                <button id="addPlayersBtn" class="btn btn-select" onclick="showAddPlayers()">Agregar más jugadores</button>
                <div id="addPlayersSection" class="hidden" style="margin-top: 10px;">
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <input type="text" id="newPlayerName" placeholder="Nombre del jugador" style="flex: 1; padding: 8px;">
                        <button class="btn btn-select" onclick="addNewPlayer()">Agregar</button>
                    </div>
                </div>
                <ul id="availablePlayers" class="player-list">
                    <!-- Jugadores se cargarán aquí -->
                </ul>
            </div>

            <div class="controls">
                <button onclick="resetDraft()">Reiniciar Draft</button>
                <button class="download-btn" onclick="downloadPDF()">Descargar PDF</button>
            </div>
        </div>
    </div>

    <!-- Modal para selección -->
    <div id="selectionModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Seleccionar</h3>
                <button class="close-modal" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalContent">
                <!-- Contenido dinámico -->
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        // Variables globales
        let allPlayers = [];
        let availablePlayers = [];
        let team1 = {
            name: "Equipo 1",
            manager: null,
            players: {},
            extras: []
        };
        let team2 = {
            name: "Equipo 2",
            manager: null,
            players: {},
            extras: []
        };
        let currentPickingTeam = 1;
        let currentPosition = null;
        let currentTeamForSelection = null;
        let selectingManager = false;

        // Posiciones de softball
        const positions = [
            { id: "pitcher", name: "Pitcher" },
            { id: "catcher", name: "Catcher" },
            { id: "firstBase", name: "1B" },
            { id: "secondBase", name: "2B" },
            { id: "thirdBase", name: "3B" },
            { id: "shortstop", name: "SS" },
            { id: "leftField", name: "LF" },
            { id: "centerField", name: "CF" },
            { id: "rightField", name: "RF" },
            { id: "extra", name: "DH/Extra" }
        ];

        // Elementos del DOM
        const setupScreen = document.getElementById('setupScreen');
        const draftScreen = document.getElementById('draftScreen');
        const team1NameInput = document.getElementById('team1Name');
        const team2NameInput = document.getElementById('team2Name');
        const playerListInput = document.getElementById('playerList');
        const startDraftBtn = document.getElementById('startDraftBtn');
        const currentPickInfo = document.getElementById('currentPickInfo');
        const currentTeamNameSpan = document.getElementById('currentTeamName');
        const team1Title = document.getElementById('team1Title');
        const team2Title = document.getElementById('team2Title');
        const availablePlayersUl = document.getElementById('availablePlayers');
        const selectionTitle = document.getElementById('selectionTitle');
        const selectionModal = document.getElementById('selectionModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalContent = document.getElementById('modalContent');

        // Inicializar el draft
        function initializeDraft() {
            // Obtener nombres de equipos
            team1.name = team1NameInput.value || "Equipo 1";
            team2.name = team2NameInput.value || "Equipo 2";
            
            // Actualizar títulos
            team1Title.textContent = team1.name;
            team2Title.textContent = team2.name;
            
            // Obtener lista de jugadores
            const playersText = playerListInput.value;
            allPlayers = playersText.split(/[\n,]/)
                .map(player => player.trim())
                .filter(player => player !== "");
            
            // Si no hay jugadores ingresados, usar los predeterminados
            if (allPlayers.length === 0) {
                allPlayers = [
                    "Juan Pérez", "Carlos Gómez", "María Rodríguez", "Luis Hernández", 
                    "Ana Torres", "Pedro Díaz", "Laura Soto", "Miguel Reyes", 
                    "Sofía Vargas", "Roberto Cruz", "Elena Ramos", "Andrés Castro", 
                    "Gabriela Gil", "Fernando Vega", "Isabel Núñez", "Diego Molina", 
                    "Valeria Pineda", "José Ortiz", "Camila Blanco", "Ricardo Marín"
                ];
            }
            
            // Inicializar listas de jugadores
            availablePlayers = [...allPlayers];
            
            // Inicializar jugadores de los equipos
            positions.forEach(pos => {
                if (pos.id !== 'extra') {
                    team1.players[pos.id] = null;
                    team2.players[pos.id] = null;
                }
            });
            team1.extras = [];
            team2.extras = [];
            team1.manager = null;
            team2.manager = null;
            
            // Crear posiciones en los equipos
            createTeamPositions();
            
            // Actualizar managers
            updateManagersDisplay();
            
            // Actualizar lista de jugadores disponibles
            updateAvailablePlayers();
            
            // Actualizar información del turno
            updateTurnInfo();
            
            // Mostrar pantalla del draft
            setupScreen.classList.add('hidden');
            draftScreen.classList.remove('hidden');
        }

        // Crear posiciones en los equipos
        function createTeamPositions() {
            const team1Positions = document.getElementById('team1-positions');
            const team2Positions = document.getElementById('team2-positions');
            
            team1Positions.innerHTML = '';
            team2Positions.innerHTML = '';
            
            positions.forEach(pos => {
                // Equipo 1
                const team1Row = document.createElement('div');
                team1Row.className = 'position-row';
                team1Row.innerHTML = `
                    <div class="position-info">
                        <div class="position-name">${pos.name}</div>
                        <div class="position-player" id="team1-${pos.id}">(Vacante)</div>
                    </div>
                    <div class="position-actions" id="team1-${pos.id}-actions">
                        <button class="btn btn-select" onclick="startSelectPlayer('${pos.id}', 1)">Seleccionar</button>
                    </div>
                `;
                team1Positions.appendChild(team1Row);
                
                // Equipo 2
                const team2Row = document.createElement('div');
                team2Row.className = 'position-row';
                team2Row.innerHTML = `
                    <div class="position-info">
                        <div class="position-name">${pos.name}</div>
                        <div class="position-player" id="team2-${pos.id}">(Vacante)</div>
                    </div>
                    <div class="position-actions" id="team2-${pos.id}-actions">
                        <button class="btn btn-select" onclick="startSelectPlayer('${pos.id}', 2)">Seleccionar</button>
                    </div>
                `;
                team2Positions.appendChild(team2Row);
            });
        }

        // Actualizar visualización de managers
        function updateManagersDisplay() {
            const team1Manager = document.getElementById('team1-manager');
            const team2Manager = document.getElementById('team2-manager');
            const team1RemoveBtn = document.getElementById('team1-remove-manager');
            const team2RemoveBtn = document.getElementById('team2-remove-manager');
            
            if (team1.manager) {
                team1Manager.textContent = team1.manager;
                team1RemoveBtn.style.display = 'inline-block';
            } else {
                team1Manager.textContent = "(Sin asignar)";
                team1RemoveBtn.style.display = 'none';
            }
            
            if (team2.manager) {
                team2Manager.textContent = team2.manager;
                team2RemoveBtn.style.display = 'inline-block';
            } else {
                team2Manager.textContent = "(Sin asignar)";
                team2RemoveBtn.style.display = 'none';
            }
        }

        // Actualizar una posición
        function updatePosition(team, positionId) {
            const playerCell = document.getElementById(`team${team}-${positionId}`);
            const actionsCell = document.getElementById(`team${team}-${positionId}-actions`);
            const teamObj = team === 1 ? team1 : team2;
            const player = positionId !== 'extra' ? teamObj.players[positionId] : null;
            const extras = positionId === 'extra' ? teamObj.extras : null;
            
            if (positionId !== 'extra') {
                if (player) {
                    playerCell.textContent = player;
                    playerCell.parentElement.parentElement.classList.add('position-filled');
                    actionsCell.innerHTML = `
                        <button class="btn btn-replace" onclick="startReplacePlayer('${positionId}', ${team})">Reemplazar</button>
                        <button class="btn btn-remove" onclick="removePlayer('${positionId}', ${team})">Eliminar</button>
                    `;
                } else {
                    playerCell.textContent = "(Vacante)";
                    playerCell.parentElement.parentElement.classList.remove('position-filled');
                    actionsCell.innerHTML = `
                        <button class="btn btn-select" onclick="startSelectPlayer('${positionId}', ${team})">Seleccionar</button>
                    `;
                }
            } else {
                if (extras.length > 0) {
                    playerCell.textContent = extras.join(", ");
                    playerCell.parentElement.parentElement.classList.add('position-filled');
                    actionsCell.innerHTML = `
                        <button class="btn btn-select" onclick="startAddExtra(${team})">Agregar</button>
                        <button class="btn btn-remove" onclick="clearExtras(${team})">Limpiar</button>
                    `;
                } else {
                    playerCell.textContent = "(Vacante)";
                    playerCell.parentElement.parentElement.classList.remove('position-filled');
                    actionsCell.innerHTML = `
                        <button class="btn btn-select" onclick="startAddExtra(${team})">Agregar</button>
                    `;
                }
            }
        }

        // Iniciar selección de manager
        function startSelectManager(team) {
            selectingManager = true;
            currentTeamForSelection = team;
            showSelectionModal("Seleccionar Manager", availablePlayers);
        }

        // Mostrar modal de selección
        function showSelectionModal(title, items) {
            modalTitle.textContent = title;
            modalContent.innerHTML = '';
            
            if (items.length === 0) {
                const message = document.createElement('p');
                message.textContent = "No hay opciones disponibles";
                modalContent.appendChild(message);
            } else {
                const list = document.createElement('ul');
                list.style.padding = '0';
                list.style.listStyle = 'none';
                
                items.forEach(item => {
                    const li = document.createElement('li');
                    li.style.padding = '8px';
                    li.style.marginBottom = '5px';
                    li.style.backgroundColor = '#e9ecef';
                    li.style.borderRadius = '4px';
                    li.style.display = 'flex';
                    li.style.justifyContent = 'space-between';
                    li.style.alignItems = 'center';
                    
                    const nameSpan = document.createElement('span');
                    nameSpan.textContent = item;
                    nameSpan.style.flex = '1';
                    nameSpan.style.whiteSpace = 'nowrap';
                    nameSpan.style.overflow = 'hidden';
                    nameSpan.style.textOverflow = 'ellipsis';
                    
                    const selectBtn = document.createElement('button');
                    selectBtn.className = 'btn btn-select';
                    selectBtn.textContent = selectingManager ? 'Asignar' : 'Seleccionar';
                    selectBtn.onclick = () => {
                        if (selectingManager) {
                            assignManager(item);
                        } else {
                            assignPlayerToPosition(item);
                        }
                        closeModal();
                    };
                    
                    li.appendChild(nameSpan);
                    li.appendChild(selectBtn);
                    list.appendChild(li);
                });
                
                modalContent.appendChild(list);
            }
            
            selectionModal.classList.remove('hidden');
        }

        // Cerrar modal
        function closeModal() {
            selectionModal.classList.add('hidden');
            selectingManager = false;
        }

        // Asignar manager a un equipo
        function assignManager(manager) {
            const team = currentTeamForSelection;
            const teamObj = team === 1 ? team1 : team2;
            
            // Si ya tenía manager, lo liberamos
            if (teamObj.manager) {
                availablePlayers.push(teamObj.manager);
            }
            
            // Asignar nuevo manager
            teamObj.manager = manager;
            
            // Eliminar manager de la lista de disponibles
            const index = availablePlayers.indexOf(manager);
            if (index !== -1) {
                availablePlayers.splice(index, 1);
            }
            
            // Actualizar UI
            updateManagersDisplay();
            updateAvailablePlayers();
        }

        // Eliminar manager de un equipo
        function removeManager(team) {
            const teamObj = team === 1 ? team1 : team2;
            
            if (teamObj.manager) {
                availablePlayers.push(teamObj.manager);
                teamObj.manager = null;
                
                // Actualizar UI
                updateManagersDisplay();
                updateAvailablePlayers();
            }
        }

        // Iniciar selección de jugador para una posición
        function startSelectPlayer(positionId, team) {
            if (currentPickingTeam !== team && positionId !== 'extra') {
                alert(`No es el turno de ${team === 1 ? team1.name : team2.name}. Es el turno de ${currentPickingTeam === 1 ? team1.name : team2.name}.`);
                return;
            }
            
            selectingManager = false;
            currentPosition = positionId;
            currentTeamForSelection = team;
            showSelectionModal(`Seleccionar para ${positions.find(p => p.id === positionId).name}`, availablePlayers);
        }

        // Iniciar reemplazo de jugador
        function startReplacePlayer(positionId, team) {
            currentPosition = positionId;
            currentTeamForSelection = team;
            selectingManager = false;
            showSelectionModal(`Reemplazar en ${positions.find(p => p.id === positionId).name}`, availablePlayers);
        }

        // Iniciar adición de extra
        function startAddExtra(team) {
            currentPosition = 'extra';
            currentTeamForSelection = team;
            selectingManager = false;
            showSelectionModal("Agregar DH/Extra", availablePlayers);
        }

        // Asignar jugador a una posición
        function assignPlayerToPosition(player) {
            if (!currentPosition || !currentTeamForSelection) return;
            
            const team = currentTeamForSelection;
            const teamObj = team === 1 ? team1 : team2;
            
            // Verificar que el jugador no esté ya en el equipo (excepto para extras)
            if (currentPosition !== 'extra') {
                if (Object.values(teamObj.players).includes(player) || teamObj.extras.includes(player) || teamObj.manager === player) {
                    alert("Este jugador ya está en el equipo.");
                    return;
                }
                
                // Si es reemplazo, liberar al jugador anterior
                if (teamObj.players[currentPosition]) {
                    availablePlayers.push(teamObj.players[currentPosition]);
                }
                
                // Asignar nuevo jugador
                teamObj.players[currentPosition] = player;
                
                // Eliminar jugador de la lista de disponibles
                const index = availablePlayers.indexOf(player);
                if (index !== -1) {
                    availablePlayers.splice(index, 1);
                }
                
                // Cambiar turno (excepto para extras)
                if (currentPosition !== 'extra') {
                    currentPickingTeam = currentPickingTeam === 1 ? 2 : 1;
                }
            } else {
                // Para extras
                if (teamObj.extras.includes(player) || teamObj.manager === player || Object.values(teamObj.players).includes(player)) {
                    alert("Este jugador ya está en el equipo.");
                    return;
                }
                
                teamObj.extras.push(player);
            }
            
            // Resetear selección
            currentPosition = null;
            currentTeamForSelection = null;
            
            // Actualizar UI
            updatePosition(team, currentPosition || 'extra');
            updateAvailablePlayers();
            updateTurnInfo();
        }

        // Eliminar jugador de una posición
        function removePlayer(positionId, team) {
            const teamObj = team === 1 ? team1 : team2;
            
            if (teamObj.players[positionId]) {
                availablePlayers.push(teamObj.players[positionId]);
                teamObj.players[positionId] = null;
                
                // Actualizar UI
                updatePosition(team, positionId);
                updateAvailablePlayers();
            }
        }

        // Limpiar extras
        function clearExtras(team) {
            const teamObj = team === 1 ? team1 : team2;
            
            if (teamObj.extras.length > 0) {
                availablePlayers.push(...teamObj.extras);
                teamObj.extras = [];
                
                // Actualizar UI
                updatePosition(team, 'extra');
                updateAvailablePlayers();
            }
        }

        // Actualizar lista de jugadores disponibles
        function updateAvailablePlayers() {
            availablePlayersUl.innerHTML = '';
            
            if (availablePlayers.length === 0) {
                const li = document.createElement('li');
                li.className = 'player-item';
                li.textContent = "No hay jugadores disponibles";
                availablePlayersUl.appendChild(li);
            } else {
                availablePlayers.forEach(player => {
                    const li = document.createElement('li');
                    li.className = 'player-item';
                    
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'player-name';
                    nameSpan.textContent = player;
                    
                    const actionsDiv = document.createElement('div');
                    actionsDiv.className = 'player-actions';
                    
                    li.appendChild(nameSpan);
                    li.appendChild(actionsDiv);
                    availablePlayersUl.appendChild(li);
                });
            }
        }

        // Actualizar información del turno
        function updateTurnInfo() {
            const currentTeam = currentPickingTeam === 1 ? team1 : team2;
            currentTeamNameSpan.textContent = currentTeam.name;
            currentTeamNameSpan.style.color = currentPickingTeam === 1 ? '#007bff' : '#dc3545';
            currentPickInfo.textContent = `Es el turno de ${currentTeam.name} para elegir.`;
        }

        // Mostrar sección para agregar jugadores
        function showAddPlayers() {
            const addPlayersSection = document.getElementById('addPlayersSection');
            addPlayersSection.classList.toggle('hidden');
        }

        // Agregar nuevo jugador
        function addNewPlayer() {
            const playerName = document.getElementById('newPlayerName').value.trim();
            if (playerName === "") {
                alert("Por favor ingresa un nombre válido.");
                return;
            }
            
            if (allPlayers.includes(playerName)) {
                alert("Este jugador ya existe.");
                return;
            }
            
            allPlayers.push(playerName);
            availablePlayers.push(playerName);
            
            document.getElementById('newPlayerName').value = "";
            updateAvailablePlayers();
            document.getElementById('addPlayersSection').classList.add('hidden');
        }

        // Reiniciar el draft
        function resetDraft() {
            if (confirm('¿Estás seguro que quieres reiniciar el draft? Se perderán todos los jugadores elegidos.')) {
                setupScreen.classList.remove('hidden');
                draftScreen.classList.add('hidden');
            }
        }

        // Descargar PDF con las selecciones
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            let yOffset = 20;
            const lineHeight = 10;

            doc.setFontSize(16);
            doc.text("Resultados del Draft de Softball", 105, yOffset, null, null, "center");
            yOffset += 15;

            // Equipo 1
            doc.setFontSize(14);
            doc.text(`${team1.name}:`, 20, yOffset);
            yOffset += lineHeight;
            
            doc.setFontSize(12);
            doc.text(`Manager: ${team1.manager || "No asignado"}`, 25, yOffset);
            yOffset += lineHeight;
            
            let hasPlayers1 = false;
            positions.forEach(pos => {
                if (pos.id !== 'extra') {
                    if (team1.players[pos.id]) {
                        doc.text(`- ${pos.name}: ${team1.players[pos.id]}`, 25, yOffset);
                        yOffset += lineHeight;
                        hasPlayers1 = true;
                    }
                } else {
                    if (team1.extras.length > 0) {
                        doc.text(`- ${pos.name}: ${team1.extras.join(", ")}`, 25, yOffset);
                        yOffset += lineHeight;
                        hasPlayers1 = true;
                    }
                }
            });
            
            if (!hasPlayers1) {
                doc.text("No hay jugadores seleccionados.", 25, yOffset);
                yOffset += lineHeight;
            }
            
            yOffset += 10;

            // Equipo 2
            doc.setFontSize(14);
            doc.text(`${team2.name}:`, 20, yOffset);
            yOffset += lineHeight;
            
            doc.setFontSize(12);
            doc.text(`Manager: ${team2.manager || "No asignado"}`, 25, yOffset);
            yOffset += lineHeight;
            
            let hasPlayers2 = false;
            positions.forEach(pos => {
                if (pos.id !== 'extra') {
                    if (team2.players[pos.id]) {
                        doc.text(`- ${pos.name}: ${team2.players[pos.id]}`, 25, yOffset);
                        yOffset += lineHeight;
                        hasPlayers2 = true;
                    }
                } else {
                    if (team2.extras.length > 0) {
                        doc.text(`- ${pos.name}: ${team2.extras.join(", ")}`, 25, yOffset);
                        yOffset += lineHeight;
                        hasPlayers2 = true;
                    }
                }
            });
            
            if (!hasPlayers2) {
                doc.text("No hay jugadores seleccionados.", 25, yOffset);
                yOffset += lineHeight;
            }

            doc.save(`Draft_Softball_${team1.name}_vs_${team2.name}.pdf`);
        }

        // Event listeners
        startDraftBtn.addEventListener('click', initializeDraft);

        // Permitir iniciar con Enter en los campos de texto
        team1NameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') initializeDraft();
        });
        team2NameInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') initializeDraft();
        });
        playerListInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') initializeDraft();
        });
    </script>
</body>
</html>
